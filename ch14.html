<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 14. Bless Those Things! (Object-Oriented Perl)</title>
<link rel="stylesheet" type="text/css" href="9780133593044.css"/>
</head>
<body>
<h2 id="ch14"><a id="page_447"/><span class="pd_ash">Chapter 14.</span> Bless Those Things! (Object-Oriented Perl)</h2>
<div class="heading">
<h3 id="ch14lev1sec1">14.1 The OOP Paradigm</h3>
<p class="noindent">By the end of this chapter, you will be able to read and write the following code:</p>
</div>
<p class="pre">use Cirle::Area;<br/>use base qw(Shape);<br/>$c1 = Circle::Area-&gt;new();<br/>$c2 = Circle::Area-&gt;new();<br/><br/>$c1-&gt;setRadius(5);<br/>$c1-&gt;setArea();<br/>$c2-&gt;setRadius(12);<br/>$c2-&gt;setArea();<br/><br/>print $c1-&gt;getArea();</p>
<div class="heading">
<h4 id="ch14lev2sec1">14.1.1 What Are Objects?</h4>
<p class="noindent">Objects are things we deal with every day. Most programming languages, such as <em>Java</em> and <em>C++,</em> also deal with objects, and those languages are called OOP (Object-Oriented Programming) languages. OOP is a way of organizing a program to solve problems in terms of real-world objects. Early Perl (Perl 4) did not support OOP, but with the advent of Perl 5, the big addition was the ability to do object-oriented programming.</p>
</div>
<p class="indent">Today, many programmers prefer to use a module called Moose to simplify Perl OOP. We&#8217;ll get into Moose later, but to start, this chapter will demonstrate the traditional Perl style.</p>
<p class="indent">OOP is not for everyone and not necessarily the best solution to your problem. Not every program lends itself to using OOP, but as the programs get larger and more complex, involve the reuse of code, perform multiple operations on related data, or are shared by <a id="page_448"/>multiple programmers, the OOP approach can prove to be more efficient. See the Perl documentation (<em><a href="http://perldoc.perl.org/perlootut.html">http://perldoc.perl.org/perlootut.html</a></em>) for a complete discussion on why you might use the OOP paradigm.</p>
<p class="indent">OOP provides a way to organize a collection of data into a single unit. For example, languages such as <em>C++</em> and <em>Java,</em> bundle up data into a variable and call it an <strong>object</strong>. When learning about objects, they are often compared to real-world things, such as a cat, a computer, or an employee. A cat, a computer, and an employee are nouns.</p>
<p class="indent">Next, we have adjectives that describe the nouns. For example, &#8220;the cat is black and sneaky,&#8221; &#8220;the computer is portable and fast,&#8221; or &#8220;the employee is called John.&#8221; In OOP languages, the adjectives that describe the objects are called <strong>properties</strong> or <strong>attributes</strong>.</p>
<p class="indent">We also have verbs that describe what the objects can do or what can be done to them. These verbs are called <strong>methods</strong>. For example, &#8220;the cat eats and sleeps,&#8221; &#8220;the computer boots or crashes,&#8221; or &#8220;the employee works.&#8221; Perl methods are just special subroutines.</p>
<p class="indent">The object&#8217;s data is normally kept <strong>private</strong>. Messages are sent to the object through its methods. The methods are normally <strong>public</strong>. The only way that a user of the program should access the data is through these public methods. The idea of hiding data and using methods to interact with the data is known as <strong>data encapsulation</strong>, a fundamental principal of all object-oriented programing. If you have an object called <em>account</em>, the methods to manipultate it might be <em>view()</em>, <em>withdraw()</em>, <em>deposit()</em>, and so forth. The account details are kept private, and the only way to access it are through the public methods, similar to putting an ATM card in the bank machine. You access your money through the menus provided for you, but you can&#8217;t directly take it from the machine.</p>
<div class="heading">
<h4 id="ch14lev2sec2">14.1.2 What Is a Class?</h4>
<p class="noindent">In OOP languages, the data and the methods are packaged up into a data structure called a <strong>class</strong>. It contains a collection of properties to describe an object and functions, called <strong>methods</strong>, to determine its behavior, but by itself, a class is merely a template or a blueprint that defines what an object looks like and what it can do. A class represents a group of similar objects, such as a class of employees, a class of cars, or a class of computers.</p>
</div>
<p class="indent">Encapsulation and information hiding are closely related terms you will hear often in the OOP world. When combining the properties and methods of an object within a class, the details can be hidden from the user, or <strong>encapsulated</strong> within the class. The user of the class should only access the data through functions or methods provided by the class. Perl has no specific keywords for <em>private</em> or <em>public</em> as found in languages such as <em>C++</em> and <em>Java</em>.</p>
<p class="indent">The object in a class is a concrete person, place, or thing. Like a blueprint, a class gives an object form, and as with a blueprint, you can use it to build many objects of the same class. For example, an object in an <em>Employee</em> class might be described to have a <em>name</em>, <em>address</em>, and <em>phone number</em>. There may be one <em>employee</em> object or many more, but they all have a <em>name</em>, an <em>address</em>, and a <em>phone number</em> as defined by the <em>Employee</em> class. Although the object can later change its values, it still belongs to the same class. Classes can also be <a id="page_449"/>extended to create more refined classes. From a <em>Computer</em> class, for example, you could create a <em>Laptop</em> class or a <em>SmartPhone</em> class, allowing you to reuse functionality already built into the <em>Computer</em> class. This ability to extend a class is called <strong>inheritance</strong>.</p>
<p class="indent">In Perl, a package will function as a class when using the object-oriented approach. This is not really a new idea for Perl, since data is already encapsulated in packages. Recall from our short discussion of packages that a package gives a sense of privacy to your program. Each package has its own symbol table, a hash that contains all the global names (not <em>my</em> variables) in the &#8220;current&#8221; package. This makes it possible to create variables and subroutines that have their own namespace within a package. The idea of hiding data in packages, then, is inherently part of Perl, and as stated earlier, also happens to be one of the basic tenets of object-oriented programming.</p>
<p class="indent">By putting a package in a separate file containing subroutines, we created a Perl module in the last chapter. It was a procedural or top-down style of programming in that the focus of the program was on how the subroutines were to act on the data provided to them, whereas in this chapter we will build an object-oriented module in the same fashion but where the focus is on the data or object. Special features introduced in Perl 5 give you the ability to model your programs with the object-oriented way of abstract thinking. You can think of procedural languages as action-oriented and OO languages as object-oriented.</p>
<p class="indent">Tom Christianson, discussing Perl and objects on his Web page &#8220;Easy Perl5 Object Intro,&#8221; says that people tend to shy away from highly convenient Perl 5 modules because some of them deal with objects. Unfortunately, some problems very much lend themselves to objects. Christianson says that people shouldn&#8217;t be scared by this, because merely knowing enough object-oriented programming to use someone else&#8217;s modules is not nearly as difficult as actually designing and implementing one yourself.<sup><a id="ch14fn1a" href="ch14.html#ch14fn1">1</a></sup> Even if you are not interested in writing programs that take advantage of the OOP features of Perl but still need to use Perl modules that do utilize objects, reading through this chapter should greatly enhance your understanding of how these modules work.</p>
<p class="footnote"><a id="ch14fn1" href="ch14.html#ch14fn1a">1</a>. Go to <em><a href="http://perl.com/doc/FMTEYEWTK/easy_objects.html">http://perl.com/doc/FMTEYEWTK/easy_objects.html</a></em> to see Tom Christianson&#8217;s Web page.</p>
<div class="heading">
<h4 id="ch14lev2sec3">14.1.3 Some Object-Oriented Lingo</h4>
<p class="noindent">Object-oriented programming is a huge subject. Thousands of books have been written on its design and methodology. Many programmers of the 1990s moved away from traditional top-down structured programming and toward object-oriented programming languages for building complex software. This is not a book on object-oriented design or programming. However, there are some basic key words associated with OOP that should be mentioned before tackling Perl&#8217;s OOP features. They are listed in <a href="ch14.html#ch14tab01">Table 14.1</a>.</p>
</div>
<div class="tab-heading">
<div class="image"><a id="page_450"/><a id="ch14tab01"/><img src="graphics/14tab01.jpg" alt="Image"/></div>
<p class="tab-caption"><strong>Table 14.1</strong> OOP Terminology</p>
</div>
<div class="heading">
<h3 id="ch14lev1sec2">14.2 Perl Classes, Objects, and Methods&#8212;Relating to the Real World</h3>
<p class="noindent">As previously mentioned, OOP is a way of organizing a program to solve problems in terms of real-world objects. For example, suppose you want to build a house. First, you would buy a piece of property located at a specific address. Then you would hire an architect to create the blueprint and design the house. You would decide on the style, how many rooms, doors, windows, and so on. After you design the house, you will hire a contractor to build the house. Once it&#8217;s built, and you have access to your new house, you can go inside, paint it, clean it, furnish it, remove trash, landscape it, whatever.</p>
</div>
<p class="indent">Since you now have the blueprints, you could, in the future, find another piece of property and build another house at a new address just like your first house. However, this time you could paint it a different color, change the landscaping, and so forth. In fact, you could build a whole development with houses like yours from the same design, each house identified by its unique address.</p>
<p class="indent">In an object-oriented language, the house would be the object, a noun. The style or number of rooms would be the properties that describe the object, like adjectives. The verbs, such as paint the house, clean the house, or show the house, would describe the behaviors for the object. The class would be the blueprint produced by the architect.</p>
<p class="indent">All of this will become clearer as we examine a number of examples and discuss how Perl creates, manipulates, and destroys objects.</p>
<div class="heading">
<h4 id="ch14lev2sec4"><a id="page_451"/>14.2.1 The Steps</h4>
<p class="noindent">This chapter will discuss a number of topics in detail. For the big picture, the following steps are necessary to create the new data type, called an object, and define what it can do:</p>
</div>
<p class="indenthangingN"><strong>1.</strong> Determine what your object (noun) is and what it is supposed to accomplish (design) and put it in a class; for example, it could be a house, employee, circle, database handle, file, or so forth.</p>
<p class="indenthangingN"><strong>2.</strong> Create the new object (reference to scalar, array, hash, subroutine, and so on) in a package, called a class. Give it a unique identity (constructor).</p>
<p class="indenthangingN"><strong>3.</strong> Describe the object by giving it properties, also called attributes (adjectives). (Defining attributes can be done when the object is created or later on in the program.)</p>
<p class="indenthangingN"><strong>4.</strong> Bless the object into the class (make the data type an object), and make an association between the object and the class.</p>
<p class="indenthangingN"><strong>5.</strong> Define the instance/access methods (subroutines) to create behaviors for the object that describe what the object can do or what can be done to it (verbs).</p>
<p class="indent">After defining the class, including the object and its methods, we need to define the user interface, as follows:</p>
<p class="indenthangingN"><strong>1.</strong> Use the class; i.e., load the class into the progam&#8217;s memory.</p>
<p class="indenthangingN"><strong>2.</strong> Create an instance of the class (call the constructor method).</p>
<p class="indenthangingN"><strong>3.</strong> Manipulate the object (call access methods).</p>
<p class="indent">And finally we can:</p>
<p class="indenthangingN"><strong>1.</strong> Reuse the class (inheritance).</p>
<p class="indenthangingN"><strong>2.</strong> Destroy the object (remove the object from memory).</p>
<div class="heading">
<h4 id="ch14lev2sec5">14.2.2 A Complete Object-Oriented Perl Program</h4>
<p class="noindent">Before getting into the details, let&#8217;s look at a complete object-oriented Perl script and then break it down, step by step, as the chapter progresses. By the end of this chapter, come back to this example, and any part that confuses you now, should be cleared up. In fact, this example will probably look trivial and you may have suggestions on how to improve it. For now, this is a good template to start with. Note that the class definition and the user interface are all in one file. Later, we will separate them into two parts with the class in one file (a module), and the user of the module in another (the driver program); specifically, we will create a <em>House.pm</em> module, with the user interface as the driver program.</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_452"/><a id="ch14exa01"/>EXAMPLE 14.1</p>
<p class="codelink1"><a id="p14exa01" href="ch14_images.html#p14exa01a">Click here to view code image</a></p>
<p class="pre1">package House;&#160;&#160;# <span class="EmpItalic">House class</span><br/>use warnings;<br/>use strict;<br/>sub new{&#160;&#160;# <span class="EmpItalic">The constructor method</span><br/>&#160;&#160;&#160;my $class=shift;<br/>&#160;&#160;&#160;my $house_obj={ "Owner"=&gt;"Planet Bank",&#160;&#160;# <span class="EmpItalic">Properties</span>/<span class="EmpItalic">attributes</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Color"=&gt;"Beige",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Payment"=&gt;undef,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;return bless($house_obj, $class); # <span class="EmpItalic">The blessing creates the object</span><br/>}<br/><br/>sub set_owner{&#160;&#160;# <span class="EmpItalic">Instance/Access methods</span><br/>&#160;&#160;&#160;my $self=shift;<br/>}<br/>sub set_color{<br/>&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;$self-&gt;{"Color"}=shift;<br/>}<br/>sub set_payment{<br/>&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;my $payment=shift;<br/>&#160;&#160;&#160;$self-&gt;{"Payment"}=$payment unless $payment &lt; 0;;<br/>}<br/>sub get_owner{&#160;&#160;# <span class="EmpItalic">Retrieve data from the object</span><br/>&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;return $self-&gt;{Owner};<br/>}<br/><br/>#----------<span class="EmpItalic">End of Class definition</span>----------------------------------<br/><br/># <span class="EmpItalic">User of the Class</span><br/>use Data::Dumper;&#160;&#160;# <span class="EmpItalic">We'll look at the structure of the object</span><br/><br/>my $house1=House-&gt;new();&#160;&#160;&#160;# <span class="EmpItalic">Make a new house object and get back</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">its address</span><br/>my $house2=House-&gt;new();&#160;&#160;&#160;# <span class="EmpItalic">Make another house object</span><br/>$house2-&gt;set_owner("Mr. T"); # <span class="EmpItalic">Change the default owner of the</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">second house</span><br/>$house2-&gt;set_payment("2000");# <span class="EmpItalic">Set the payment of the second house</span><br/>print "The owner of my first house is ", $house1-&gt;get_owner(),"\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Retrieve data from the first house.</span><br/><br/>print Dumper($house1,$house2);&#160;&#160;# <span class="EmpItalic">Look at the content of the</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">house objects</span><br/><a id="page_453"/>(Output)<br/><span class="EmpItalic">The owner of my first house is Planet Bank</span><br/><span class="EmpItalic">$VAR1 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Owner' =&gt; 'Planet Bank',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Payment' =&gt; undef,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Color' =&gt; 'Beige'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'House' );</span><br/><span class="EmpItalic">$VAR2 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Owner' =&gt; 'Mr. T',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Payment' =&gt; 2000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Color' =&gt; 'Beige'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'House' );</span><br/>&#160;&#160;<span class="EmpItalic">}</span></p>
<hr/></div>
<div class="heading">
<h5 id="ch14lev3sec1">A Perl Package Is a Class</h5>
<p class="noindent">A Perl package serves as a class. There is no reserved word called <em>class</em>, but with object-oriented Perl, a package is often called a class. A class is normally stored in a .<em>pm</em> module, and the class name is the same as the module (minus the .<em>pm</em> extension). If you want to distinguish between the two terms, a class is a package containing special subroutines called methods that create and manipulate an object. A Perl class normally consists of the following:</p>
</div>
<p class="indenthangingN"><strong>1.</strong> The data that describes the object.</p>
<p class="indenthangingN"><strong>2.</strong> A constructor method that creates the object with a <em>bless</em> function.</p>
<p class="indenthangingN"><strong>3.</strong> Special subroutines, called &#8220;methods,&#8221; that know how to create, access, manipulate, and destroy the object.</p>
<p class="indent">There are no special Perl keywords such as <em>private</em>, <em>public,</em> or <em>protected</em> as in other object-oriented languages. Perl&#8217;s package mechanism makes up the class where the data and subroutines, called methods, are stored. The <em>my</em> function keeps variables lexically scoped, and the <em>bless</em> function guarantees that when the object is created, it will know to which class it belongs. In summary, the object is a reference to an anonymous hash, array, scalar, or subroutine and is manipulated by special functions called methods that get access to the object via the reference.</p>
<div class="heading">
<h5 id="ch14lev3sec2">A Perl Class</h5>
<p class="noindent">Since a class is really just a package, it has its own symbol table, and the global data or routines in one class can be accessed in another.</p>
</div>
<p class="indent">Unlike other languages, Perl does not strictly monitor public/private borders within its modules.<sup><a id="ch14fn2a" href="ch14.html#ch14fn2">2</a></sup> To keep data private, there are several techniques that can be used (see <a href="ch14.html#ch14lev1sec3">Section 14.3</a>, &#8220;<a href="ch14.html#ch14lev1sec3">Anonymous Subroutines, Closures, and Privacy</a>,&#8221; later in this chapter).</p>
<p class="footnote"><a id="ch14fn2" href="ch14.html#ch14fn2a">2</a>. Wall, L., and Schwartz, R. L., <em>Programming Perl</em>, 2nd ed., O&#8217;Reilly &#38; Associates: Sebastopol, CA, 1998, p. 287.</p>
<div class="fig-heading">
<div class="image"><a id="page_454"/><a id="ch14fig01"/><img src="graphics/14fig01.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.1</strong> What makes up a class?</p>
</div>
<div class="heading">
<h4 id="ch14lev2sec6">14.2.3 Perl Objects</h4>
<div class="heading">
<h5 id="ch14lev3sec3">References</h5>
<p class="noindent">To begin with, an object in Perl is created by using a reference. You may want to review <a href="ch12.html#ch12">Chapter 12</a>, &#8220;<a href="ch12.html#ch12">Does This Job Require a Reference?</a>&#8221; if you are not clear about how to use references. Briefly, a reference is a scalar that holds the address of some variable. A reference might also point to a data type that has no name, called an <strong>anonymous variable</strong>. For example, here is a reference, called <em>$ref</em>, to an anonymous hash consisting of two key/value pairs:</p>
</div>
</div>
<p class="codelink"><a id="p454pro01" href="ch14_images.html#p454pro01a">Click here to view code image</a></p>
<p class="pre">my $ref={"Owner"=&gt;"Tom", "Price"=&gt;"25000"};</p>
<p class="indent">To access a value in the anonymous hash, the reference (pointer) <em>$ref</em> can be dereferenced by using the arrow operator, as follows:</p>
<p class="pre">$ref-&gt;{"Owner"}</p>
<p class="indent">To make a Perl object, first a reference is created. The reference is often to an anonymous hash (although it could be assigned the address of an array or scalar or even a subroutine). The hash will contain the data members and properties of the object.</p>
<div class="heading">
<h5 id="ch14lev3sec4">The Blessing</h5>
<p class="noindent">The memory address referenced (called a <strong>referent</strong>), must be &#8220;blessed&#8221; in order to transform it into a Perl object; in other words, the referent must know what package it belongs to. This is done by creating the reference and then blessing (the thing it references) into a package. Think of the blessing as creating a new data type, an object.</p>
</div>
<p class="codelink"><a id="p455pro01" href="ch14_images.html#p455pro01a">Click here to view code image</a></p>
<p class="pre"><a id="page_455"/>my $ref={Owner=&gt;"Tom", Price=&gt;250000};&#160;&#160;# <span class="EmpItalic">Properties Owner, Price</span><br/><span class="EmpStrong">bless($ref, "House");</span>&#160;&#160;# <span class="EmpItalic">Tag the reference as belonging to a House</span><br/><span class="EmpStrong">return $ref</span>;&#160;&#160;# <span class="EmpItalic">A reference to the object is returned to the caller</span></p>
<p class="indent">The <em>bless</em> function takes one or two arguments. The first argument is <span class="underline">always</span> a reference, and the second optional argument is the name of the class (package). The <em>bless</em> function tags the thing being referenced (called a referent). It creates an internal pointer to track what package the thing (object) belongs to. The object is the thing (usually a hash) that was blessed into the class (package). If the package is not listed as the second argument, the <em>bless</em> function assumes the current package.</p>
<p class="indent">The <em>bless</em> function returns a reference to the blessed object. In the <a href="ch14.html#ch14fig02">Figure 14.2</a>, the address of the object is displayed before the blessing and after the blessing. Notice that after the blessing, the address is tagged with the name of the class, in this example <em>House</em>.</p>
<div class="fig-heading">
<div class="image"><a id="ch14fig02"/><img src="graphics/14fig02.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.2</strong> An address before and after the blessing.</p>
</div>
<p class="indent">Since the blessing associates the object with a particular package (class), Perl will always know to what package the object belongs, eliminating the need to use the :: syntax we used in the procedural modules. An object can be blessed into one class and then <em>reblessed</em> into another and then another, and so on, but an object can belong to only one class at a time. Once an object has been blessed, you don&#8217;t have to export symbols with the <em>@EXPORT_OK</em> or <em>@EXPORT</em> arrays. In fact, as a general rule, if the module is trying to be object-oriented, then export nothing.</p>
<div class="heading">
<h4 id="ch14lev2sec7"><a id="page_456"/>14.2.4 Methods Are Perl Subroutines</h4>
<div class="heading">
<h5 id="ch14lev3sec5">Definition</h5>
<p class="noindent">A <strong>method</strong> is a subroutine that works with objects. For example, it is used to create an object, store or modify data in an object, retrieve data from the object, and so on. It is a special subroutine that belongs to a class, and its first argument will be one of the following:</p>
</div>
</div>
<p class="indenthangingN"><strong>1.</strong> A class (package) name</p>
<p class="indenthangingN"><strong>2.</strong> A reference to an object</p>
<p class="indent">This first argument is sent by Perl implicitly. Even though you may call a method without any arguments, Perl will automatically send one; either a package name or object reference. Otherwise, it looks like any other subroutine. In <a href="ch14.html#ch14exa01">Example 14.1</a>, we created two house objects. The method to create the objects was called <em>new</em> (although it could be called anything) and as you can see next, when the method is called, it is preceded by the class name, <em>House</em>, followed by an arrow, <em>House</em>-<em>&gt;new()</em>. Perl will automatically send what is on the left-hand side of the arrow to the method. So in this case, the <em>new()</em> method will automatically get one argument, which is <em>House</em>, the class name.</p>
<p class="indenthangingN"><strong>1.</strong> Perl implicitly sends the name of the class to the <em>new()</em> method.</p>
<div class="image"><img src="graphics/456pro01.jpg" alt="Image"/></div>
<p class="indenthangingNP">Although the parameter list for the <em>new</em> method is empty, Perl will implicitly send what is on the left-hand side of the arrow to the method; in this case, <em>House</em> (the name of the class) is sent to <em>new()</em> as its first argument.</p>
<p class="indenthangingN"><strong>2.</strong> Perl sends a reference to the second house, <em>$house2</em>, to the <em>set_owner()</em> method.</p>
<p class="codelink"><a id="p456pro02" href="ch14_images.html#p456pro02a">Click here to view code image</a></p>
<p class="pre"><span class="EmpStrong">$house2-&gt;set_owner</span>("Mr. T"); # <span class="EmpItalic">Perl sends the address of the second</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">house as the first argument to set_owner()</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">and "Mr. T" as the second argument</span></p>
<p class="indent">The first argument in the <em>set_owner()</em> method appears to be <em>&#34;Mr. T&#34;</em> but it&#8217;s not. The first argument in this method is a reference to the second house object, <em>$house2</em>. Notice this time, the reference is on the left-hand side of the arrow rather than the class name. Perl will implicitly send the reference as the first argument to this method, and <em>&#34;Mr. T&#34;</em> as the second. In that way, you can be assured that when you set the owner for the second house, Perl will know which address to go to.</p>
<div class="heading">
<h5 id="ch14lev3sec6"><a id="page_457"/>Types of Methods</h5>
<p class="noindent">Now that we&#8217;ve had a brief introduction, let&#8217;s learn a little more about methods. There are two types of methods: class (or static) methods and instance methods.<sup><a id="ch14fn3a" href="ch14.html#ch14fn3">3</a></sup> The class method expects a class name as its first argument, and the instance method expects an object reference as its first argument.</p>
</div>
<p class="footnote"><a id="ch14fn3" href="ch14.html#ch14fn3a">3</a>. What you call a method type depends on what book you read. Larry Wall categorizes methods as class methods, instance methods, and dual-nature methods.</p>
<p class="indent">A <strong>class method</strong> is a subroutine that affects the class as a whole; for example, it can create an object or act on a group of objects. It is independent; meaning, it doesn&#8217;t require an object as its first argument. A counter function to keep track of the number of objects created within a class, can be considered a class method. Another example of a class method is a constructor. In object-oriented programs, a <strong>constructor</strong> is a class method used to create an object and receives the class name as its first argument. In Perl, this method is commonly called <em>new</em>, although you can call it anything you like. The creation of the object is often called the <strong>instantiation</strong> of the object, or instance of the class.</p>
<p class="indent">Object-oriented programs use <strong>instance methods</strong> (also called access or mutator methods) to control the way the object&#8217;s data is assigned, modified, and retrieved. You can&#8217;t use an instance method until you have created the object. Once the reference to the newly created object is returned, the instance method uses that reference, often called <em>$this</em> or <em>$self</em>, to manipulate the object. The instance method automatically receives a reference to the object as its first argument. In that way, it knows which object to manipulate; for example, when invoking a <em>speak</em> method, <em>$dogref</em>-&gt;<em>speak()</em> gets a dog reference and might return &#8220;Woof woof,&#8221; whereas <em>$catref</em>-<em>&gt;speak()</em> gets a cat reference and might return &#8220;Meow.&#8221; Perl sends the reference for you.</p>
<div class="heading">
<h5 id="ch14lev3sec7">Invoking Methods</h5>
<p class="noindent">Perl provides a special syntax for invoking methods. Instead of using the <em>package::function</em> syntax, methods are invoked in one of two ways: class method invocation or instance method invocation. There are two types of syntax for each method call: object-oriented syntax (shown in all the examples in this chapter) and indirect syntax. If you are using objects, either syntax for these method calls is acceptable, but the object-oriented syntax is less ambiguous. The older way of calling methods with the double colons is not recommended.</p>
</div>
<p class="indent"><strong>Something to remember</strong>: a method, unlike an ordinary subroutine, is always sent one argument implicitly, either the name of the class or a reference to the object. If, for example, you call a method with three arguments, four arguments are really sent, the first one being the value found on the left-hand side of the arrow when using the object-oriented style.</p>
<div class="heading">
<h6 id="ch14lev4sec1">Class Method Invocation</h6>
<p class="noindent">Assume the method name is called <em>new</em> and the return value, <em>$ref</em>, is a pointer to the object.</p>
</div>
<p class="codelink"><a id="p457pro01" href="ch14_images.html#p457pro01a">Click here to view code image</a></p>
<p class="pre">1) $ref = class-&gt;new( list of arguments );&#160;&#160;&#160;# <span class="EmpItalic">object-oriented syntax</span><br/>2) $ref = new class ( list of arguments );&#160;&#160;&#160;# <span class="EmpItalic">indirect syntax</span></p>
<p class="indent"><a id="page_458"/>If the class is called <em>House</em>, Perl translates</p>
<p class="pre">$ref = House-&gt;new();</p>
<p class="noindent">to</p>
<p class="pre1">$ref = House::new(House);</p>
<div class="heading">
<h6 id="ch14lev4sec2">Instance Method Invocation</h6>
<p class="noindent">Assume the method name is called <em>display</em> and the reference to the object is called <em>$obj</em>.</p>
</div>
<p class="codelink"><a id="p458pro01" href="ch14_images.html#p458pro01a">Click here to view code image</a></p>
<p class="pre">1) $obj-&gt;display( list of arguments );&#160;&#160;&#160;&#160;# <span class="EmpItalic">object-oriented syntax</span><br/>2) display $obj ( list of arguments );&#160;&#160;&#160;&#160;# <span class="EmpItalic">indirect syntax</span></p>
<p class="indent">The example using the arrow operator to invoke a method is called the object-oriented style and is the most commonly used. We will use that style throughout this text; the example without the arrow operator is called the indirect syntax.</p>
<p class="indent">When Perl sees one of the preceding methods being invoked, it knows what class the object belongs to, because the object was blessed (an internal pointer is tracking where it is).<sup><a id="ch14fn4a" href="ch14.html#ch14fn4">4</a></sup></p>
<p class="footnote"><a id="ch14fn4" href="ch14.html#ch14fn4a">4</a>. The capability of Perl to call the appropriate module&#8217;s function is called runtime binding, according to Srinivasan, S., <em>Advanced Perl Programming,</em> O&#8217;Reilly &#38; Associates: Sebastopol, CA, 1997.</p>
<p class="indent">If you call either</p>
<p class="pre">display $ref (<span class="EmpStrong">arguments...</span>);</p>
<p class="noindent">or</p>
<p class="pre">$ref-&gt;display(<span class="EmpStrong">arguments...</span>);</p>
<p class="noindent">and <em>$ref</em> points to an object in a class called <em>House</em>, Perl translates that to</p>
<p class="codelink"><a id="p458pro02" href="ch14_images.html#p458pro02a">Click here to view code image</a></p>
<p class="pre">House::display($ref, arguments...);</p>
<div class="heading">
<h5 id="ch14lev3sec8">Creating the Object with a Constructor</h5>
<p class="noindent">To create a <em>House</em> class, we first create a package. This package is called <em>House.</em> In object-oriented lingo, the package will now be called a <strong>class</strong>. A function called a constructor method is used to create the object and give it a memory address so that your program can access it.</p>
</div>
<p class="indent">The properties, or attributes, describe characteristics of the object, such as its owner, style, size, color, and so forth. In our example, the house properties are <em>Owner</em>, <em>Color,</em> and <em>Payment</em>. There are a variety of ways to set the properties. Often, the object is described with an anonymous hash, where the key/value pairs are the properties of the object.</p>
<p class="indent">In the following example, the class is called <em>House</em> and the constructor method is called <em>new()</em>. You don&#8217;t have to name the constructor &#8220;new.&#8221; You can call it whatever fits your situation best. Since we&#8217;re making a new house, the name &#8220;new&#8221; seems as fitting as any <a id="page_459"/>other name; we could have easily used <em>create()</em>, <em>build()</em>, <em>startup()</em>, or <em>init()</em>. The job of the constructor is to set up a memory location for the new <em>House</em> object; in other words, to get a reference to the object. We can define the actual properties later, but first we need to get the address for the object, just as you have to have an address for a new house before you can build it.</p>
<p class="indent">Like any other function, the constructor can receive additional arguments from the caller, and use them as &#8220;instance&#8221; variables. The next step is to make sure Perl knows that this new address is always associated with its class. The new <em>house</em> object is a member of the <em>House</em> class, and the <em>bless</em> function makes sure Perl knows that. Simply, it converts the ordinary pointer into an object. The piece of memory it points to is stamped: &#8220;I&#8217;m not a Car, or a Horse, or a Cat. I am a House!&#8221;</p>
<p class="indent"><a href="ch14.html#ch14exa02">Example 14.2</a> illustrates how to define the constructor method, create a reference, and transform it into an object via the <em>bless</em> function. At this point in the program, we are only defining the method. Later, we will invoke it.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa02"/>EXAMPLE 14.2</p>
<p class="codelink1"><a id="p14exa02" href="ch14_images.html#p14exa02a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;<span class="EmpStrong">package House;</span>&#160;&#160;&#160;# <span class="EmpItalic">Name of the class</span><br/><br/>2&#160;&#160;<span class="EmpStrong">sub new</span>{&#160;&#160;# <span class="EmpItalic">The constructor method</span><br/><br/>3&#160;&#160;&#160;&#160;&#160;&#160;my $class=shift @_;&#160;&#160;# <span class="EmpItalic">First argument is the name of the class</span><br/>4&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $house_obj</span>={ "Owner"=&gt;"Planet Bank", # <span class="EmpItalic">Default attributes</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Color"=&gt;"Beige",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Payment"=&gt;undef,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/><br/>5&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">bless($house_obj, $class);</span>&#160;&#160;# <span class="EmpItalic">Create the object by blessing it</span><br/>6&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return $house_obj</span>;<br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">The blessing transforms the ordinary pointer into a pointer to an</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">object. The object now belongs to the House</span> class.<br/>&#160;&#160;&#160;}</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>House</em> is declared. It can be called a class because it contains a method that will bless a reference.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The subroutine <em>new</em> is called a <strong>constructor</strong> method in OOP lingo. The primary job of a constructor is to create and initialize an object. In Perl, it doesn&#8217;t really have any special syntax. This is called a class method, since its first argument is the name of the class which is shifted from the @_ array. (See <a href="ch14.html#ch14exa04">Example 14.4</a> to see how this method is invoked.) It is a subroutine that blesses a referenced &#8220;thing&#8221; (object) into a class and returns a reference to it. The subroutine is called a <strong>method</strong> and the &#8220;thing&#8221; it blessed is an <strong>object</strong>. The package is called a <strong>class</strong>.</p>
<p class="sb-indenthangingN"><a id="page_460"/><strong>3.</strong> The first argument received by this type of subroutine is the name of the package or class, in this case <em>House</em>. This is another difference between a method and a subroutine. The first argument of a method is the name of either a class or an object.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The reference <em>$house_obj</em> is assigned the address of an anonymous hash (object). There are three keys with values. The value of <em>&#34;Payment&#34;</em> is assigned <em>undef,</em> meaning the values at this time are undefined and will be defined later. These key/value pairs serve as default attributes/properties for the <em>house</em> object. You could leave the hash empty and set the properties later; for example, <em>$house_obj = {}</em>;. They can be set or modified by instance methods defined in <a href="ch14.html#ch14exa03">Example 14.3</a>.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The reference, <em>$house_obj</em>, is the first argument to the <em>bless()</em> function, and the name of the class is the second argument. The blessing does not bless the reference. It blesses the location that the reference points to, called the <strong>referent</strong>. It tags that location with the class name, transforming the ordinary reference into a reference to an object.</p>
<p class="sb-indenthangingN"><strong>6.</strong> A reference to the object is returned to the caller.</p>
<hr/></div>
<div class="heading">
<h5 id="ch14lev3sec9">Creating the Instance Methods</h5>
<p class="noindent">Outside of the constructor method, other methods can be defined. In the object-oriented world, these methods are called public methods, and they are the way you get access to the object, but not until an instance of it exists. They often describe behaviors of the object; meaning, what it can do or what can be done to it. In fact, the methods should be the only way to get access to the object.</p>
</div>
<p class="indent">For our <em>house</em> object, one method to access the house might be to move in, another to clean it, another to display it, and so on. Methods in Perl are just glorified subroutines. In the following example, we add three instance (mutators or setters) methods to the <em>House</em> class. These methods, <em>set_owner()</em>, <em>set_color()</em>, and <em>set_price()</em> all assume that an instance of the object has already been created; in other words, you can&#8217;t own, paint, or make payments on the house if it doesn&#8217;t exist. <strong>The instance methods always get a reference to the object as their first argument.</strong> Once the method has the address of the object and knows what class it belongs to (blessing), it will go to that address and perform whatever tasks it is programmed to do, such as set values, return values, change the defaults; for example, calculate the mortgage, add a garage, clean the kitchen, tear it down, and so forth.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa03"/>EXAMPLE 14.3</p>
<p class="codelink1"><a id="p14exa03" href="ch14_images.html#p14exa03a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;package House;&#160;&#160;&#160;# <span class="EmpItalic">Name of the class</span><br/><br/>2&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $house_obj={ "Owner"=&gt;"Planet Bank",&#160;&#160;&#160;# <span class="EmpItalic">Default attributes</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Color"=&gt;"Beige",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Payment"=&gt;undef,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;&#160;&#160;&#160;return bless($house_obj, $class);<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;#--------------------------------------------------------------------<br/><a id="page_461"/>&#160;&#160;&#160;# <span class="EmpItalic">Create the instance methods that will manipulate the object</span><br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">The setter methods</span><br/>3&#160;&#160;<span class="EmpStrong">sub set_owner{</span>&#160;&#160;&#160;# <span class="EmpItalic">Access or instance methods</span><br/>4&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my ($self, $owner)= @_;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a pointer to the house object</span><br/>5&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">$self-&gt;{"Owner"}=$owner;</span>&#160;&#160;&#160;# <span class="EmpItalic">Set a new owner</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;<span class="EmpStrong">sub set_color{</span>&#160;&#160;# <span class="EmpItalic">Setter method</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my ($self,$color) = @_;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a pointer to the house object.</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">$self-&gt;{"Color"}=$color;</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/><br/>&#160;&#160;&#160;<span class="EmpStrong">sub set_payment{</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my ($self, $payment) = @_;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">$self-&gt;{"Payment"}=$payment;</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">The getter methods</span><br/><span class="EmpStrong">6&#160;&#160;sub get_owner{</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self=shift;</span><br/><span class="EmpStrong">7&#160;&#160;&#160;&#160;&#160;return $self-&gt;{"Owner"};</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;<span class="EmpStrong">sub get_color{</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self=shift;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return $self-&gt;{"Color"};</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;<span class="EmpStrong">sub get_payment{</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self=shift;</span><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return $self-&gt;{"Payment"};</span><br/>&#160;&#160;&#160;}</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The class is <em>House</em>.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The constructor is defined with default properties.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The instance methods are defined here. This is the <em>set_owner</em> method, called a &#8220;setter&#8221; (mutator). It stores the data in the object.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The first argument received by the <em>set_owner</em> method is a reference to the object. It is called <em>$self. $self</em> is commonly used, but the method can be called any valid variable name. The second argument is the value of the <em>Owner</em> property for the object. When the method is called by the user, Perl implicitly sends a reference to the object first and then any other arguments sent by the user.</p>
<p class="sb-indenthangingN"><strong>5.</strong> A reference to the object is stored in <em>$self</em>. The value of the <em>Owner</em> property is assigned to the object via this reference.</p>
<p class="sb-indenthangingN"><strong>6.</strong> This method is called a &#8220;getter.&#8221; It retrieves (gets) information from the object. The first argument is the address of the object, <em>$self</em>.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The value of the <em>Owner</em> property is retrieved and returned to the user.</p>
<hr/></div>
<div class="heading">
<h5 id="ch14lev3sec10"><a id="page_462"/>Invoking the Methods (User Interaction)</h5>
<p class="noindent">Now that we have created the class and its methods, it is time to invoke the methods. For this example the methods and user interaction will be in one file, but in the next section, there will be two files: a file containing the class module (a <em>.pm</em> file), and a separate file for the user interface. Whether defined within one file or more, the class definition is a separate from the main program. In the following example, some of the instance methods have been cut out to reduce the size of the example and to enhance the section where the user comes in.</p>
</div>
<div class="fig-heading">
<div class="image"><a id="ch14fig03"/><img src="graphics/14fig03.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.3</strong> Two houses with different addresses.</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa04"/>EXAMPLE 14.4</p>
<p class="codelink1"><a id="p14exa04" href="ch14_images.html#p14exa04a">Click here to view code image</a></p>
<p class="pre1"># <span class="EmpItalic">The Class Definition Outside the Main Part of the Program</span><br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>1&#160;&#160;package House;&#160;&#160;&#160;# <span class="EmpItalic">Name of the class</span><br/>2&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $house_obj={ "Owner"=&gt;"Planet Bank", # <span class="EmpItalic">Default attributes</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Color"=&gt;"Beige",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Payment"=&gt;undef,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;&#160;&#160;&#160;return bless($house_obj, $class);<br/>&#160;&#160;&#160;}<br/>#------------------------------------------------------------------------<br/>&#160;&#160;&#160;# <span class="EmpItalic">Create the functions/methods that will manipulate the object</span><br/>3&#160;&#160;sub set_owner{&#160;&#160;&#160;# <span class="EmpItalic">Access or instance methods</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a pointer to the house object</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{"Owner"}=shift;&#160;&#160;&#160;# <span class="EmpItalic">Now set a new owner.</span><br/>&#160;&#160;&#160;}<br/><a id="page_463"/>&#160;&#160;&#160;sub set_color{<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a pointer to the house object.</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{"Color"}=shift;<br/>&#160;&#160;&#160;}<br/><br/>&#160;&#160;&#160;sub set_payment{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{"Payment"}=shift;<br/>&#160;&#160;&#160;}<br/><br/>4&#160;&#160;<span class="EmpStrong">sub get_owner{</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self=shift;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return $self-&gt;{Owner};</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/><br/><span class="EmpStrong">#------------------------------------------------------</span><br/><span class="EmpStrong">#</span>&#160;&#160;<span class="EmpItalic">Now we enter the main part or user part of the program</span><br/>&#160;&#160;&#160;use Data::Dumper;&#160;&#160;# <span class="EmpItalic">Dump out both objects to display contents</span><br/><br/>5&#160;&#160;<span class="EmpStrong">my $house1 = House-&gt;new();</span> # <span class="EmpItalic">Call constructor to create</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">a new house object</span><br/><br/>6&#160;&#160;<span class="EmpStrong">my $house2=House-&gt;new();</span> # <span class="EmpItalic">Create another house object</span><br/><br/>7&#160;&#160;<span class="EmpStrong">$house2-&gt;set_owner("Mr. T");</span> # <span class="EmpItalic">Call access method for the second house</span><br/><br/>&#160;&#160;&#160;<span class="EmpStrong">$house2-&gt;set_payment("2000");</span><br/><br/>8&#160;&#160;<span class="EmpStrong">print "The owner of my first house is ",$house1-&gt;get_owner(),"\n";</span><br/><br/>9&#160;&#160;print Dumper($house1,$house2);&#160;&#160;# <span class="EmpItalic">Take a look at the two instances</span><br/><br/>(Output)<br/><span class="EmpItalic">The owner of my first house is Planet Bank</span><br/><span class="EmpItalic">$VAR1 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Owner' =&gt; 'Planet Bank',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Payment' =&gt; undef,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Color' =&gt; 'Beige'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'House' );</span><br/><span class="EmpItalic">$VAR2 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Owner' =&gt; 'Mr. T',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Payment' =&gt; '2000',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Color' =&gt; 'Beige'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'House' );</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_464"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>House</em> class is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> This is the constructor method that gives us the reference to our new house and blesses it into the class; meaning, it creates an instance of the <em>House</em> class.</p>
<p class="sb-indenthangingN"><strong>3.</strong> Now the instance methods are defined in order to set values or retrieve values from a house object.</p>
<p class="sb-indenthangingN"><strong>4.</strong> This is a &#8220;getter&#8221; method designed to retrieve data from house objects.</p>
<p class="sb-indenthangingN"><strong>5.</strong> Now the user is ready to create more house objects. This is a call to the <em>new()</em> constructor method. The first argument is on the left-hand side of the arrow; this is the name of the class. A reference to a blessed house object is returned and assigned to <em>$house1</em>.</p>
<p class="sb-indenthangingN"><strong>6.</strong> Another house object, <em>$house2</em>, is created and its reference returned.</p>
<p class="sb-indenthangingN"><strong>7.</strong> Once we have an instance of the object, we can go to that address and set values. The instance method, <em>set_owner()</em>, implicitly gets <em>$house2</em> as its first argument, that is what is on the left-hand side of the arrow. Getting the address of the second house as its first argument ensures that Perl sets data at the correct location. The second argument, <em>&#34;Mr. T&#34;,</em> is supplied by the user. This will override the default value set in the constructor, <em>&#34;Planet Bank&#34;.</em></p>
<p class="sb-indenthangingN"><strong>8.</strong> Now we retrieve the value of the owner for the first house with the <em>get_owner()</em> method.</p>
<p class="sb-indenthangingN"><strong>9.</strong> The <em>Data::Dumper</em> function displays the values of both houses. (You could save this data in a file and reconstruct the objects with it.) If you set <em>$Data::Dumper::Terse=1</em>, the <em>$VAR1</em> and <em>$VAR2</em> variables will be omitted in the display. For serialization of the objects, see <em><a href="http://perl.find-info.ru/perl/025/advperl2-chp-4-sect-2.html">http://perl.find-info.ru/perl/025/advperl2-chp-4-sect-2.html</a></em>.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec8">14.2.5 Creating an Object-Oriented Module</h4>
<p class="noindent">In the last example, all of the code was contained within a single package in a single file. Now it&#8217;s time to create a module.</p>
</div>
<p class="indent"><a href="ch14.html#ch14fig04">Figure 14.4</a> illustrates the layout of a simple object-oriented module and the user interface. The <em>.pm</em> file where the class is defined is a module. In this example, the <em>.pm</em> file is <em>House.pm</em>. The file consists of one package declaration. The package will be called a <em>class</em>; so, this is the <em>House</em> class. Normally the class name is the same as the module name minus the <em>.pm</em> extension. The class consists of subroutines, now called <em>methods</em>, as shown in the previous example. The first method in the sample program is called <em>new</em>, a constructor method. It is the method that will define and create (construct) the object. When a user of this module calls the method <em>new</em>, he will get back a reference to the newly blessed <em>House</em> object (the address of the house). The instance methods store and fetch the data from the object. Once the user has a reference to the object, it will be used to call the instance methods.</p>
<div class="fig-heading">
<div class="box">
<hr/>
<p class="noindent"><a id="ch14fig04"/>The Module Filename: <em>House.pm</em></p>
<hr/>
<p class="codelink"><a id="p465pro01" href="ch14_images.html#p465pro01a">Click here to view code image</a></p>
<p class="pre1"><span class="EmpStrong">package House</span>;&#160;&#160;# <span class="EmpItalic">House is the class</span><br/># <span class="EmpItalic">The package name normally matches the filename minus the .pm extension</span><br/>sub new{&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Constructor method</span><br/>&#160;&#160;&#160;my $class = shift;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is the name of the class</span><br/>&#160;&#160;&#160;my $house_obj = { };&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Create the reference/pointer.</span><br/>&#160;&#160;&#160;bless($house_obj, $class);&#160;&#160;&#160;# <span class="EmpItalic">Bless the referent; Create an object</span><br/>&#160;&#160;&#160;return $house_obj;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Return a reference to the object</span><br/>}<br/><br/>sub set_owner{&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Access/instance method</span><br/>&#160;&#160;&#160;my $self = shift;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a reference to the object</span><br/>&#160;&#160;&#160;$self-&gt;{"Owner"}=shift;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Sometimes called a "setter" method</span><br/>}<br/>sub get_owner{&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Access/instance method</span><br/>&#160;&#160;&#160;my $self = shift;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">First argument is a reference to the object</span><br/>&#160;&#160;&#160;return $self-&gt;{"Owner"};&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Sometimes called a "getter" method</span><br/>}<br/><span class="EmpStrong">1</span>;&#160;&#160;# <span class="EmpItalic">Must return a true value, or module won't load</span></p>
<hr/>
<p class="noindent">The user of the Class; the Perl script, <em>myHouse.plx</em></p>
<hr/>
<p class="codelink"><a id="p465pro02" href="ch14_images.html#p465pro02a">Click here to view code image</a></p>
<p class="pre1"><span class="EmpStrong">use House;</span>&#160;&#160;# <span class="EmpItalic">Tell Perl to load House.pm</span><br/><br/>my $house1 = House-&gt;new();&#160;&#160;&#160;# <span class="EmpItalic">Call class constructor.</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Get back a reference to a new house. Perl sends</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">the name of the class as its first argument</span><br/>my $house2 = House-&gt;new();&#160;&#160;&#160;# <span class="EmpItalic">Create another house object</span><br/><br/>$house1-&gt;set_owner("B of A"); # <span class="EmpItalic">Call access method;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Perl sends the address of the first house</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">object, to method set_owner()</span><br/><br/>print "The owner of the first house is ", $house1-&gt;get_owner, "\n";<br/>&#160;&#160;&#160;&#160;# <span class="EmpItalic">Perl gets the object's data with the get_owner access method</span></p>
<hr/></div>
</div>
<p class="fig-caption"><strong>Figure 14.4</strong> A simple object-oriented module.</p>
<p class="indent">Another little detail: when the class is separated from the user interface, as in the procedural modules we created in <a href="ch13.html#ch13">Chapter 13</a>, &#8220;<a href="ch13.html#ch13">Modularize It, Package It, and Send It to the Library!</a>&#8221; it <span class="underline">must return a true value</span> by placing a <em>1;</em> at the end of the module.</p>
<p class="indent"><a id="page_465"/>The user of the module, must designate the module to be included with the <em>use Module</em> directive, also discussed in <a href="ch13.html#ch13">Chapter 13</a>.</p>
<p class="indent">There are many ways the module can be designed. This is just one simple approach.</p>
<div class="heading">
<h5 id="ch14lev3sec11"><a id="page_466"/>Passing Arguments to Methods</h5>
<p class="noindent">Instance variables are used to initialize the object when it is created. In this way, each time the object is created, it can be customized. The properties that describe the object may be passed as arguments to the constructor method and assigned to instance variables. They are called <strong>instance variables</strong> because they come into existence when the object is created, or instantiated. Either an anonymous hash or an anonymous array is commonly used to hold the instance variables. In the following example, the object &#8220;has a&#8221; or &#8220;contains a&#8221; owner and a price.</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa05"/>EXAMPLE 14.5</p>
<p class="codelink1"><a id="p14exa05" href="ch14_images.html#p14exa05a">Click here to view code image</a></p>
<p class="pre1">(The Module: <span class="EmpItalic">House.pm</span>)<br/>1&#160;&#160;<span class="EmpStrong">package House;</span><br/>2&#160;&#160;<span class="EmpStrong">sub new</span>{&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Constructor&#160;&#160;method</span><br/>3&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $class = shift;</span><br/>4&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my ($owner, $price)</span> = @_;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Instance variables</span><br/>5&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $ref={"Owner"=&gt;$owner,</span>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Instance variables to</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"Price"=&gt;$price,</span>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">initialize the object</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>6&#160;&#160;&#160;&#160;&#160;bless($ref, $class);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return $ref;<br/>&#160;&#160;&#160;}<br/>7&#160;&#160;<span class="EmpStrong">sub display_object</span> {&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">An instance method</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self = shift;</span>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">A reference to the object is received</span><br/>8&#160;&#160;&#160;&#160;&#160;foreach $key (keys <span class="EmpStrong">%$self</span>){<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "$key: $self-&gt;{$key} \n";&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/><br/>-------------------------------------------------------------------<br/><br/>(The Script)<br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">User of the class; another program</span><br/>9&#160;&#160;<span class="EmpStrong">use House</span>;<br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">my $house1 = new House("Tom Savage", 250000);</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">Invoking constructor--two ways.</span><br/>10 <span class="EmpStrong">my $house1 = House-&gt;new("Tom Savage", 250000);</span><br/>11 <span class="EmpStrong">my $house2 = House-&gt;new("Devin Quigley", 55000);</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">Two objects have been created</span><br/>12 <span class="EmpStrong">$house1-&gt;display_object();</span><br/>13 <span class="EmpStrong">$house2-&gt;display_object();</span><br/>14 print "$house1, $house2\n";<br/><br/>(Output)<br/>12 <span class="EmpItalic">Owner: Tom Savage</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Price: 250000</span><br/>13 <span class="EmpItalic">Owner: Devin Quigley</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Price: 55000</span><br/>14 <span class="EmpItalic">House=HASH(0x9d450), House=HASH(0xa454c)</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_467"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>House</em> is declared. (At this point, the program has not provided any instructions describing what this class does or how to use it. Documentation explaining how to use a class is called the public interface. See <a href="ch14.html#ch14lev1sec5">Section 14.5</a>, &#8220;<a href="ch14.html#ch14lev1sec5">Plain Old Documentation&#8212;Documenting a Module</a>,&#8221; for instructions on how to document your modules the Perl way.)</p>
<p class="sb-indenthangingN"><strong>2.</strong> The class method <em>new</em> is defined as a constructor.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The first argument to the class method is the name of the class (package).</p>
<p class="sb-indenthangingN"><strong>4.</strong> The &#8220;instance variables&#8221; are created from the remainder of the @_ array.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The address of an anonymous hash is assigned to the reference <em>$ref</em>. The keys are hard coded and the values are supplied from the instance variables.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The &#8220;thing&#8221; the reference <em>$ref</em> points to is blessed into the class and becomes the new object.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The value of the reference <em>$ref</em> will be returned when the method is called. The subroutine <em>display_object</em> is an instance method. It is defined in this class.</p>
<p class="sb-indenthangingNP">The first argument to the instance method is the reference to the object.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The <em>foreach</em> loop is used with the <em>keys</em> function to get the keys from the hash (object) referenced by <em>$self,</em> and in the block of the loop to print both keys and values.</p>
<p class="sb-indenthangingN"><strong>9.</strong> The user of the class loads <em>House.pm</em> into his namespace.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The <em>new</em> method is called with three arguments, <em>House</em>, <em>Tom Savage,</em> and <em>250000</em>. The first argument is the name of the class. You don&#8217;t see it, but Perl implictly sends it to the constructor. The next two arguments are sent explicitly by the user of the class. The only requirement here is that the <em>Owner</em> value is the first argument and the <em>Price</em> value is the second argument. There is no error checking. The example simply shows how to pass arguments to a constructor. A reference to a new <em>House</em> object is returned and assigned to <em>$house1,</em> a reference to a hash.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> The <em>new</em> method is called again with different arguments, <em>Devin Quigley</em> and <em>55000.</em> The value returned to <em>$house2</em> is a reference to another object. The <em>new</em> method has been used to create two <em>House</em> objects. You can create as many objects as you want. They will all have unique addresses, as shown in the output at line 14. Since the objects were blessed in the constructor, Perl knows that the objects are in the <em>House</em> class.</p>
<p class="sb-indenthangingN1"><strong>12.</strong> The instance method is called to display the data for the object referenced by <em>$house1</em>.</p>
<p class="sb-indenthangingN1"><strong>13.</strong> The instance method is called again but to display the data of the object referenced by <em>$house2</em>.</p>
<p class="sb-indenthangingN1"><strong>14.</strong> The addresses of the two objects are printed. You can see that the addresses have been tagged as belonging to the <em>House</em> class.</p>
<hr/></div>
<div class="heading">
<h5 id="ch14lev3sec12">Passing Parameters to Instance Methods</h5>
<p class="noindent">The first argument to an instance method is always a reference to the object. In the called method, this value is typically shifted from the <em>@_</em> array and stored in a variable called <em>$self</em> or <em>$this</em>, although it doesn&#8217;t matter what you call the variable. The remaining arguments are then processed as they are in any regular subroutine.</p>
</div>
<p class="indent"><a id="page_468"/>The following example demonstrates an instance method that is sent additional arguments when called.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa06"/>EXAMPLE 14.6</p>
<p class="codelink1"><a id="p14exa06" href="ch14_images.html#p14exa06a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;#!/bin/perl<br/>&#160;&#160;&#160;# <span class="EmpItalic">Program to demonstrate passing arguments to an instance method.</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">In this example, a pointer to an array is passed.</span><br/>1&#160;&#160;package House;&#160;&#160;# <span class="EmpItalic">Class</span><br/>&#160;&#160;&#160;use warnings;<br/>2&#160;&#160;sub new{&#160;&#160;&#160;# <span class="EmpItalic">Constructor</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $ref={};&#160;&#160;<span class="EmpItalic"># Define properties later</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;return bless ($ref, $class);<br/>&#160;&#160;&#160;}<br/><br/>3&#160;&#160;<span class="EmpStrong">sub set_props</span>{&#160;&#160;# <span class="EmpItalic">Instance methods</span><br/>4&#160;&#160;&#160;&#160;&#160;my $object = shift;&#160;&#160;# <span class="EmpItalic">Pointer to object</span><br/>5&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $val_ptr=shift;</span>&#160;&#160;&#160;# <span class="EmpItalic">Receive another pointer</span><br/>6&#160;&#160;&#160;&#160;&#160;my <span class="EmpStrong">($owner,$price,$style)=@{$val_ptr};</span>&#160;&#160;# <span class="EmpItalic">Create a slice</span><br/>7&#160;&#160;&#160;&#160;&#160;$object-&gt;{"Owner"}=$owner;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$object-&gt;{"Price"}=$price;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$object-&gt;{"Style"}=$style<br/>&#160;&#160;&#160;}<br/>8&#160;&#160;sub get_owner{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{"Owner"};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;sub get_price{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{"Price"};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;sub get_address{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{"Address"};<br/>&#160;&#160;&#160;}<br/><br/>9&#160;&#160;sub display_props{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>10&#160;&#160;&#160;&#160;print "Properties for the ",<span class="EmpStrong">ref($self)</span>, " are:\n";<br/>11&#160;&#160;&#160;&#160;foreach $key (<span class="EmpStrong">keys %{$self}</span>){&#160;&#160;# <span class="EmpItalic">Dereference hash ref</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;printf "%-10s%-10s\n",$key,$value;2<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;&#160;&#160;# <span class="EmpItalic">Don't forget this!</span><br/>--------------------------------------------------------------------<br/><br/>(The Script)<br/>12 use House;<br/>&#160;&#160;&#160;use warnings;<br/>&#160;&#160;&#160;use strict;<br/><a id="page_469"/>13 my $h1=House-&gt;new();<br/>14 $h1-&gt;set_props([ "Unity Bank", "150000", "12 Main St."]);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Pass reference</span><br/>&#160;&#160;&#160;$h1-&gt;display_props();<br/><br/>&#160;&#160;&#160;my $h2=House-&gt;new();<br/>15 $h2-&gt;set_props([ "Pierre Dupont", "150000","Pacific Ridge" ]);<br/>&#160;&#160;&#160;$h2-&gt;display_props();<br/><br/>(Output)<br/><span class="EmpItalic">Owner&#160;&#160;&#160;&#160;&#160;Unity Bank</span><br/><span class="EmpItalic">Address&#160;&#160;&#160;12 Main St.</span><br/><span class="EmpItalic">Price&#160;&#160;&#160;&#160;&#160;150000</span><br/><span class="EmpItalic">Owner&#160;&#160;&#160;&#160;&#160;Pierre Dupont</span><br/><span class="EmpItalic">Address&#160;&#160;&#160;10 Pacific Ridge</span><br/><span class="EmpItalic">Price&#160;&#160;&#160;&#160;&#160;1500000</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>House</em> class is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>new</em> method is a constructor. The object is an empty anonymous hash. The key/value pairs, the <strong>properties</strong>, or <strong>attributes</strong>, of the object will be assigned later. The object, referenced by <em>$ref</em>, is blessed into the <em>House</em> class.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The instance method <em>set_props</em> is defined.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The first argument is a reference to a <em>House</em> object. It is shifted from the @_ array and assigned to <em>$object</em>. The name of the reference could be <em>$this</em> or <em>$self</em>. It doesn&#8217;t matter.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The second argument is a shifted from the <em>@_</em> array. It is a reference to an array.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The reference, <em>$val_ptr,</em> is dereferenced to get a list of the values passed to this method.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The values passed to the method are now assigned to the object.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The instance methods for retrieving values from the object are defined.</p>
<p class="sb-indenthangingN"><strong>9.</strong> The selected values from the hash are printed.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The built-in <em>ref</em> function, when given an object as its argument, returns the name of the class where the object was created.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> Since the object is a reference to a hash, we dereference it, <em>%$self</em>, to get to its key/value pairs. The user of the class then loads the module into his program.</p>
<p class="sb-indenthangingN1"><strong>13.</strong> A call to the constructor <em>new()</em> returns a newly blessed house.</p>
<p class="sb-indenthangingN1"><strong>14.</strong> The instance method, <em>set_props()</em>, is provided with arguments. The first implicit one is a reference to the object (what is on the left-hand side of the arrow). The second argument is a reference to an anonymous array (square brackets) containing a list of values that will be set as properties for the object.</p>
<p class="sb-indenthangingN1"><strong>15.</strong> The instance method, <em>set_props()</em>, for the second house is given a reference to a list of values.</p>
<hr/></div>
<div class="heading">
<h5 id="ch14lev3sec13"><a id="page_470"/>Named Parameters and Data Checking</h5>
<p class="noindent">All of the examples so far have used a <em>House</em> object. In the next example, we will create an <em>Employee</em> object. The <em>Employee</em> constructor will take parameters to be used as properties of an employee. If a constructor method is expecting a name, address, and salary to be passed in that order, it would be a problem if the arguments were sent in the wrong order, causing the address to be assigned to the name, or the name to the salary, and so on. One way to prevent that would be to pass arguments as a hash when calling methods. In this way when received by the method as parameters, they will be in the form of key/value pairs. (Of course, spelling the expected keys incorrectly could be a problem.) The following example demonstrates how to use named parameters.</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa07"/>EXAMPLE 14.7</p>
<p class="codelink1"><a id="p14exa07" href="ch14_images.html#p14exa07a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;# <span class="EmpItalic">User of Employee.pm--See Example 14.8 for module</span><br/>1&#160;&#160;<span class="EmpStrong">use Employee;</span><br/>2&#160;&#160;use warnings;<br/>&#160;&#160;&#160;use strict;<br/>3&#160;&#160;my($name, $extension, $address, $basepay, $employee); # <span class="EmpItalic">Declare</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">my variables</span><br/>4&#160;&#160;print "Enter the employee's name. ";<br/>&#160;&#160;&#160;chomp($name=&lt;STDIN&gt;);<br/>&#160;&#160;&#160;print "Enter the employee's phone extension. ";<br/>&#160;&#160;&#160;chomp($extension=&lt;STDIN&gt;);<br/>&#160;&#160;&#160;print "Enter the employee's address. ";<br/>&#160;&#160;&#160;chomp($address=&lt;STDIN&gt;);<br/>&#160;&#160;&#160;print "Enter the employee's basepay. ";<br/>&#160;&#160;&#160;chomp($basepay=&lt;STDIN&gt;);<br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">Passing arguments as a hash</span><br/>5&#160;&#160;<span class="EmpStrong">$employee = Employee-&gt;new(</span> "_<span class="EmpStrong">Name</span>"<span class="EmpStrong">=&gt;$name,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">Address</span>"<span class="EmpStrong">=&gt;$address,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">Extension</span>"<span class="EmpStrong">=&gt;$extension,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">PayCheck</span>"<span class="EmpStrong">=&gt;$basepay,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">);</span><br/>&#160;&#160;&#160;print "\nThe statistics for $name are: \n";<br/><br/>6&#160;&#160;$employee-&gt;get_stats;<br/><br/>(Output)<br/><span class="EmpItalic">Enter the employee's name. Daniel Savage</span><br/><span class="EmpItalic">Enter the employee's phone extension. 2534</span><br/><span class="EmpItalic">Enter the employee's address. 999 Mission Ave, Somewhere, CA</span><br/><span class="EmpItalic">Enter the employee's basepay. 2200</span><br/><br/><span class="EmpItalic">The statistics for Daniel Savage are:</span><br/><span class="EmpItalic">Address = 999 Mission Ave, Somewhere, CA</span><br/><span class="EmpItalic">PayCheck = 2200</span><br/><span class="EmpItalic">IdNum = Employee Id not provided!</span><br/><span class="EmpItalic">Extension = 2534</span><br/><span class="EmpItalic">Name = Daniel Savage</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_471"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>Employee.pm</em> module will be used by this program.</p>
<p class="sb-indenthangingN"><strong>2.</strong> <em>warnings</em> will be issued for possible errors, and the <em>strict</em> pragma will track global and undefined variables, barewords, and so forth.</p>
<p class="sb-indenthangingN"><strong>3.</strong> A list of lexical private variables is created.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The user of the program will be asked for the information that will be passed to the <em>Employee</em> module.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The constructor is called to pass arguments as key/value pairs; that is, a hash is passed to the constructor in the <em>Employee</em> module. A reference to the object is returned and assigned to <em>$employee</em>.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The instance method <em>get_stats</em> is called to display the employee&#8217;s attributes.</p>
<hr/></div>
<p class="indent">In the next example, let&#8217;s see how the module handles it&#8217;s named parameters.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa08"/>EXAMPLE 14.8</p>
<p class="codelink1"><a id="p14exa08" href="ch14_images.html#p14exa08a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;# <span class="EmpItalic">Module Employee.pm--See Example 14.7 to use this module.</span><br/>1&#160;&#160;<span class="EmpStrong">package Employee;</span><br/>2&#160;&#160;use Carp;<br/>3&#160;&#160;<span class="EmpStrong">sub new</span> {<br/>4&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>5&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my(%params)=@_;</span>&#160;&#160;&#160;# <span class="EmpItalic">Receiving the hash that was passed</span><br/>6&#160;&#160;&#160;&#160;&#160;my $ref={<br/>7&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">Name</span>"<span class="EmpStrong">=&gt;$params{</span>"_<span class="EmpStrong">Name</span>"<span class="EmpStrong">}</span> || croak("No name assigned"),<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">Extension</span>"<span class="EmpStrong">=&gt;$params{</span>"_<span class="EmpStrong">Extension</span>"<span class="EmpStrong">}</span>,<br/>8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">Address</span>"<span class="EmpStrong">=&gt;$params{</span>"_<span class="EmpStrong">Address</span>"<span class="EmpStrong">}</span>,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_<span class="EmpStrong">PayCheck</span>"<span class="EmpStrong">=&gt;$params{</span>"_<span class="EmpStrong">PayCheck</span>"} ||<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;croak("No pay assigned"),<br/>9&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">((defined $params{"_IdNum"})?("_IdNum"=&gt;$params{"_IdNum"}):</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">croak "Employee's id was not provided!\n"</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">);</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>10 return bless($ref,$class);<br/>&#160;&#160;&#160;}<br/>11 <span class="EmpStrong">sub get_stats</span>{<br/>12&#160;&#160;&#160;&#160;my $self=shift;<br/>13&#160;&#160;&#160;&#160;foreach my $key <span class="EmpStrong">(keys %params, %$self)</span>{<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print $key, " = ", $self-&gt;{$key}, "\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_472"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The class <em>Employee</em> is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>Carp</em> module from the standard Perl library is used to handle error messages. Instead of using the built-in <em>die</em> function, we can use the <em>croak</em> method from the <em>Carp</em> module to exit when there is an error, with a little more detail on what caused the error.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The constructor method <em>new</em> is defined.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The first argument to the constructor method is the name of the class. It is shifted from the <em>@_</em> array and assigned to <em>$class</em>.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The rest of the arguments in the <em>@_</em> array are assigned to the hash <em>%params</em>. They were sent to the constructor as a set of key/value pairs in the @_.</p>
<p class="sb-indenthangingN"><strong>6.</strong> A reference, <em>$ref</em>, is assigned the address of an anonymous hash.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The key <em>Name</em> is assigned a value, retrieved from the <em>%params</em> hash. Error checking is done here. If a corresponding value for the key <em>Name</em> is not provided, the <em>croak</em> function will be executed, letting the user know that he did not assign a value to the <em>Name</em>, and the program will exit.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The <em>Address</em> property is assigned by getting its value from the <em>%params</em> hash.</p>
<p class="sb-indenthangingN"><strong>9.</strong> This is an example of how you can make sure the user of the module passed the expected arguments. The conditional statement reads: If the <em>%params</em> has a key called <em>IdNum</em> defined, then get its value and assign it to <em>IdNum</em>; otherwise, when the program runs, tell the user he forgot to include this parameter. In the examples using <em>croak</em>, the program will die if the user doesn&#8217;t provide input when asked for it, whereas in this form of checking, the program will continue to run.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> After assigning properties, a reference to the object is blessed into the class and returned to the caller.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> The instance method <em>get_stats</em> is defined.</p>
<p class="sb-indenthangingN1"><strong>12.</strong> The first argument is shifted from the <em>@_</em> array and assigned to <em>$self</em>. It is a pointer to the object.</p>
<p class="sb-indenthangingN1"><strong>13.</strong> The <em>foreach</em> loop is entered. The built-in <em>keys</em> function extracts all the keys from the object. The keys and values are printed on the next line.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec9">14.2.6 Polymorphism and Runtime Binding</h4>
<p class="noindent"><em>Webster&#8217;s Dictionary</em> defines polymorphism as follows:</p>
</div>
<p class="blockquote">polymorphism: <em>n.</em> 1. the state or condition of being polymorphous.<sup><a id="ch14fn5a" href="ch14.html#ch14fn5">5</a></sup></p>
<p class="footnote"><a id="ch14fn5" href="ch14.html#ch14fn5a">5</a>. <em>Webster&#8217;s Encyclopedic Unabridged Dictionary of the English Language</em>, Random House Value Publishing: Avenel, NJ, 1996, p. 1500.</p>
<p class="noindent">There, that should clear things up! Here&#8217;s another definition from Webopedia.com:</p>
<p class="blockquote">Generally, the ability to appear in many forms. In object-oriented programming, polymorphism refers to a programming language&#8217;s ability to process objects differently depending on their data type or class.</p>
<p class="indent"><a id="page_473"/>Polymorphism can be described in many ways, and it&#8217;s a word that is inherently part of the object-oriented lingo, meaning the name of a method can have many behaviors. You can define a method with the same name in different classes and when you call the method, it will do the right thing; or you could say when the reference to the object invokes the method, it will go to the class where the object belongs.</p>
<p class="indent">Let&#8217;s move on to a new example. Let&#8217;s start with three modules, <em>BasketballPlayer.pm</em>, <em>Director.pm,</em> and <em>Rifleman.pm,</em> each of which have a <em>shoot()</em> method. The driver, or user, program will use all three modules. A blessed reference to each of the objects is returned when its respective class constructors are called. When the instance methods are called, recall that Perl sends that object&#8217;s reference as the first argument so that Perl knows which method to call and to which class it belongs, even though the methods have the same name. Perl determines which class the invoking object belongs to and looks in that class (package) for the method being called. The ability to call the right method demonstrates polymorphism.</p>
<p class="indent">When you call a function or method in a program, the method call must be associated with or bound to the definition for that method. This happens either at compile time or runtime. Runtime or dynamic binding allows the program to defer calling the correct method until the program is running; meaning, once it knows what object (reference) will be sent to the method. Along with polymorphism and runtime binding, the program can tie the correct method to its associated class without using <em>if</em> statements to determine which method to call. This provides a great deal of flexibility and is necessary for inheritance to work properly.</p>
<p class="indent">To take advantage of polymorphism and runtime binding, the object-oriented syntax must be used rather than the <em>::</em> syntax. Let&#8217;s say you have two classes, <em>Director</em> and <em>Rifleman,</em> and both classes contain an instance method called <em>shoot</em>, you can write <em>$object</em>-<em>&gt;shoot()</em>, and Perl will know which class the object belongs to because the first argument sent to the <em>shoot()</em> method will be a reference to the object. (It determined the correct class at compile time during the blessing.) In this way, the <em>Director</em> will not shoot bullets at his cast, and the <em>Rifleman</em> will not try to shoot movies on the rifle range. It is also possible to add another class, such as a <em>BasketballPlayer</em> class, with a different <em>shoot()</em> method and be sure that the appropriate method will be called for that class. Without runtime binding and polymorphism, the correct class would be determined based on the outcome of some condition, as shown here:</p>
<p class="codelink"><a id="p473pro01" href="ch14_images.html#p473pro01a">Click here to view code image</a></p>
<p class="pre">if ( ref($object1) eq "Director") {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;Director::shoot($object1);<br/>elsif ( ref($object2) eq "Rifleman" ){<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;Rifleman::shoot($object2);<br/>else{<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;BasketballPlayer::shoot($object3);<br/>}</p>
<p class="noindent">And what if you sent the <em>shoot()</em> method the wrong object? With the object-oriented syntax, a reference to the object is implicitly passed to the method. Since Perl sends the object to the instance method as its first argument and the object has been blessed into the proper class, Perl can implement polymorphism and do the right thing! Assume that, as in the <a id="page_474"/>following example, <em>$object1</em> was created as an object in the <em>Director</em> class, <em>$object2</em> as an object in the <em>Rifleman</em> class, and <em>$object3</em> as an object in the <em>BasketballPlayer</em> class.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa09"/>EXAMPLE 14.9</p>
<p class="codelink1"><a id="p14exa09" href="ch14_images.html#p14exa09a">Click here to view code image</a></p>
<p class="pre1">$object1-&gt;shoot;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">evaluates to</span>&#160;&#160;Director::shoot($object1);<br/>$object2-&gt;shoot;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">evaluates to</span>&#160;&#160;Rifleman::shoot($object2);<br/>$object3-&gt;shoot;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">evaluates to</span>&#160;&#160;BasketballPlayer::shoot($object3);</p>
<hr/></div>
<p class="indent">The following example demonstrates polymorphism. There are three classes. Each class has a constructor method (not all with the same name), and each class has an instance method, all called <em>shoot()</em>.</p>
<p class="indent">The user program includes all three modules and creates instances of each of the classes. Each time the <em>shoot()</em> method is called, Perl sends a reference to its object. Since the <em>shoot()</em> method will receive a blessed reference to the object that called it, there is no confusion as to which method the object belongs to. Perl just goes to the address for that object of that class and calls the method.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa10"/>EXAMPLE 14.10</p>
<p class="codelink1"><a id="p14exa10" href="ch14_images.html#p14exa10a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;#----------File: BasketballPlayer.pm<br/>1&#160;&#160;<span class="EmpStrong">package BasketballPlayer;</span>&#160;&#160;# <span class="EmpItalic">Class</span><br/>&#160;&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($name, $team, $position)=@_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $player={<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Name"=&gt;$name,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Team"=&gt;$team,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Position"=&gt;$position,<br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;&#160;&#160;&#160;return bless($player, $class);<br/>&#160;&#160;&#160;}<br/>2&#160;&#160;<span class="EmpStrong">sub shoot</span> {&#160;&#160;# <span class="EmpItalic">Instance method for the basketball player</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "$self-&gt;{'Name'} was a $self-&gt;{'Position'}<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and shot baskets for the $self-&gt;{Team}.\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;#----------------File: Director.pm<br/>3&#160;&#160;<span class="EmpStrong">package Director;</span>&#160;&#160;# <span class="EmpItalic">Class</span><br/>&#160;&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $info_ptr=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $director={<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Name"=&gt;$info_ptr-&gt;{"Name"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Movie"=&gt;$info_ptr-&gt;{"Movie"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Type"=&gt;$info_ptr-&gt;{"Type"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;};&#160;&#160;&#160;&#160;&#160;&#160;return bless($director, $class);<br/>&#160;&#160;&#160;}<br/><a id="page_475"/>4&#160;&#160;<span class="EmpStrong">sub shoot</span>{&#160;&#160;# <span class="EmpItalic">Instance method for the director</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "$self-&gt;{'Name'} is shooting the movie $self-&gt;{'Movie'}.\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;#----------------File: Rifleman.pm<br/>5&#160;&#160;<span class="EmpStrong">package Rifleman;</span>&#160;&#160;# <span class="EmpItalic">Class</span><br/>&#160;&#160;&#160;sub init{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($name, $shooting_range)=@_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $rifleman={<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Name"=&gt;$name,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Range"=&gt;$shooting_range,<br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;&#160;&#160;&#160;return bless($rifleman, $class);<br/>&#160;&#160;&#160;}<br/>6&#160;&#160;<span class="EmpStrong">sub shoot</span>{&#160;&#160;# <span class="EmpItalic">Instance method for the rifleman</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "$self-&gt;{'Name'} went to the $self-&gt;{'Range'} range to shoot<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;target&#160;&#160;&#160;&#160;s.\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;-------------------File: user.plx-------------------------<br/>7&#160;&#160;<span class="EmpStrong">use BasketballPlayer;</span><br/>&#160;&#160;&#160;<span class="EmpStrong">use Director;</span><br/>&#160;&#160;&#160;<span class="EmpStrong">use Rifleman;</span><br/>&#160;&#160;&#160;use feature qw(say);<br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">Create instances of each class</span><br/>8&#160;&#160;<span class="EmpStrong">$ballplayer</span>=BasketballPlayer-&gt;new("Wilt Chamberlain",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Boston Globe Trotters",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"center");<br/>9&#160;&#160;<span class="EmpStrong">$movie_director</span>=Director-&gt;new( {"Name"=&gt;"Steve McQueen",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Movie"=&gt;"12 Years A Slave",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Type"=&gt;"Historical Drama"}<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br/>10 <span class="EmpStrong">$gunman</span>=Rifleman-&gt;init("Lucas McCain", "North Fork Range");<br/>11 say "The basketball player is a ", <span class="EmpStrong">ref $ballplayer</span>;<br/>12 say "The director is a ", <span class="EmpStrong">ref $movie_director</span>;<br/>13 say "The rifleman is a ", <span class="EmpStrong">ref $gunman</span>;<br/>14 <span class="EmpStrong">$ballplayer-&gt;shoot();&#160;&#160;#</span> <span class="EmpItalic">polymorphism</span><br/>15 <span class="EmpStrong">$movie_director-&gt;shoot();</span><br/>16 <span class="EmpStrong">$gunman-&gt;shoot();</span><br/><br/>(Output)<br/>11 <span class="EmpItalic">The basketball player is a BasketballPlayer</span><br/>12 <span class="EmpItalic">The director is a Director</span><br/>13 <span class="EmpItalic">The rifleman is a Rifleman</span><br/>14 <span class="EmpItalic">Wilt Chamberlain was a center and shot baskets for the Boston Globe</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Trotters.</span><br/>15 <span class="EmpItalic">Steve McQueen is shooting the movie 12 Years A Slave.</span><br/>16 <span class="EmpItalic">Lucas McCain went to the North Fork Range range to shoot targets.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_476"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> This is the <em>BasketballPlayer</em> class, containing its own constructor and instance variables.</p>
<p class="sb-indenthangingN"><strong>2.</strong> This is the <em>shoot()</em> instance method for the <em>BasketballPlayer</em> class.</p>
<p class="sb-indenthangingN"><strong>3.</strong> Now we are in the <em>Director</em> class, which has its own constructor method called <em>new()</em> and instance variables.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>Director</em> class has defined its own <em>shoot()</em> method.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The class called <em>Rifleman</em> has defined a constructor called <em>init()</em> with instance variables pertaining to a rifleman.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The <em>Rifleman</em> class has also defined a <em>shoot()</em> method.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The driver/user program uses all three classes, the <em>BasketballPlayer</em>, the <em>Director</em>, and the <em>Rifleman</em>.</p>
<p class="sb-indenthangingN"><strong>8.</strong> A call to the <em>BasketballPlayer</em> constructor returns a reference to a new <em>BasketballPlayer</em> object.</p>
<p class="sb-indenthangingN"><strong>9.</strong> A call to the <em>Director</em> constructor returns a reference to a new <em>Director</em> object.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> And a call to the <em>Rifleman</em> constructor returns a reference to a new <em>Rifleman</em> object.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> The Perl built-in <em>ref</em> function, when given an object as its argument, will return the class name of the object rather than its data type. For an unblessed reference, the return value would have been <em>HASH</em>. You can see that the address contains the name of the class.</p>
<p class="sb-indenthangingN4"><strong>14&#8211;16.</strong> Polymorphism is demonstrated when all three objects make a call to their respective <em>shoot()</em> methods. Because Perl sends the blessed reference to the method as its first argument, Perl knows what class to go to, as you can see here. The references for the blessed objects are:</p>
<p class="sb-indenthangingNP"><em>BasketballPlayer=HASH(0x7ff98a004ff0),</em></p>
<p class="sb-indenthangingNP"><em>Director=HASH(0x7ff98a033128),</em></p>
<p class="sb-indenthangingNP"><em>Rifleman=HASH(0x7ff98a02d4d8)</em></p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec10">14.2.7 Destructors and Garbage Collection</h4>
<p class="noindent">Perl keeps track of the number of references to an object, and when the count reaches <em>0</em>, the object is automatically destroyed. If a reference goes out of scope or your program exits, Perl handles the garbage collection by destroying every object associated with a reference and deallocating any memory that was used. So, you don&#8217;t have to worry about cleaning up memory.<sup><a id="ch14fn6a" href="ch14.html#ch14fn6">6</a></sup> However, you can define a <em>DESTROY</em> method in your program to get control of the object just before it goes away.</p>
</div>
<p class="footnote"><a id="ch14fn6" href="ch14.html#ch14fn6a">6</a>. If you use self-referencing data structures, you will be responsible for destroying those references.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="page_477"/><a id="ch14exa11"/>EXAMPLE 14.11</p>
<p class="codelink1"><a id="p14exa11" href="ch14_images.html#p14exa11a">Click here to view code image</a></p>
<p class="pre1">(The Class)<br/>1&#160;&#160;package Employee;<br/>&#160;&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $name = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $ref={"Name"=&gt;$name};<br/>&#160;&#160;&#160;&#160;&#160;&#160;bless($ref, $class);<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $ref;<br/>&#160;&#160;&#160;}<br/><br/>2&#160;&#160;<span class="EmpStrong">sub DESTROY{</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self = shift;</span><br/>3&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">print "Employee $self-&gt;{Name} is being destroyed.\n";</span><br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/><br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;---------------------------------------------------------------<br/><br/>(The Script)<br/>&#160;&#160;&#160;# <span class="EmpItalic">User of the class</span><br/>4&#160;&#160;<span class="EmpStrong">use Employee;</span><br/>5&#160;&#160;my $emp1 = Employee-&gt;new("1: Daniel");<br/>6&#160;&#160;<span class="EmpStrong">{</span> my $emp2 = Employee-&gt;new("2: Tom");&#160;&#160;# <span class="EmpItalic">Lexical scoping</span><br/>7&#160;&#160;&#160;&#160;print "I'm being destroyed.\n";<br/>&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>8&#160;&#160;my $emp3 = Employee-&gt;new("3: Jenny");&#160;&#160;# <span class="EmpItalic">Create the object</span><br/><br/>(Output)<br/>7&#160;&#160;<span class="EmpItalic">I'm being destroyed.</span><br/>6&#160;&#160;<span class="EmpItalic">Employee 2: Tom is being destroyed.</span><br/>5&#160;&#160;<span class="EmpItalic">Employee 1: Daniel is being destroyed.</span><br/>8&#160;&#160;<span class="EmpItalic">Employee 3: Jenny is being destroyed.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>Employee</em> class is declared and its constructor method defined.</p>
<p class="sb-indenthangingN"><strong>2.</strong> When an <em>Employee</em> object is no longer in scope, the <em>DESTROY</em> method is called and this line is printed. The object on line 6 is defined within a block. It goes out of scope when the block exits. The other objects go out of scope when the program ends.</p>
<p class="sb-indenthangingN"><strong>3.</strong> Each time an object goes out of scope, this line is printed.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>Employee</em> module will be used.</p>
<p class="sb-indenthangingN"><strong>5.</strong> A new <em>Employee</em> object, referenced by <em>$emp1</em>, is being created by calling the constructor method and passing the name as <em>&#8220;1: Daniel&#8221;.</em></p>
<p class="sb-indenthangingN"><strong>6.</strong> Another <em>Employee</em> object is created within a block. The object is assigned a name value of <em>&#34;2: Tom&#34;</em>. Since it is a <em>my</em> variable, it is lexically scoped, meaning the object will go out of scope when the block is exited, at which time the <em>DESTROY</em> method will be called and remove it from memory.</p>
<p class="sb-indenthangingN"><a id="page_478"/><strong>7.</strong> This line is printed just before the object (<em>&#34;2: Tom&#34;</em>) goes out of scope. Then <em>DESTROY</em> is called. The <em>Employee</em> objects are assigned key/value pairs.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The last object is created (<em>&#34;3: Jenny&#34;</em>) and this is the last one to be destroyed when the program ends.</p>
<hr/></div>
<div class="heading">
<h3 id="ch14lev1sec3">14.3 Anonymous Subroutines, Closures, and Privacy</h3>
<p class="noindent">One of the problems with the object-oriented examples we have used thus far is that a user can manipulate the object directly once he gets a reference to it. Even if he is supposed to use the methods provided by the module, there is nothing to stop him from accessing the object&#8217;s data directly, since Perl does not specifically provide a private section for the class data. But for those who feel this lack of guaranteed privacy is an affront to the object-oriented approach, Perl provides several solutions. One of them is the use of closures.</p>
</div>
<div class="heading">
<h4 id="ch14lev2sec11">14.3.1 What Is a Closure?</h4>
<p class="noindent">Larry Wall describes <strong>closures</strong> as just anonymous subroutines with an attitude.<sup><a id="ch14fn7a" href="ch14.html#ch14fn7">7</a></sup> Barrie Slaymaker calls closures &#8220;inside-out objects,&#8221; in that objects are data that have some subroutines attached to them, whereas closures are subroutines that have some data attached to them.</p>
</div>
<p class="footnote"><a id="ch14fn7" href="ch14.html#ch14fn7a">7</a>. Wall, L., Christianson, T., and Orwant, J., <em>Programming Perl, 3rd ed.,</em> O&#8217;Reilly &#38; Associates: Sebastopol, CA, 2000, p. 262.</p>
<p class="indent">A closure is a subroutine that has access to <em>my</em> (lexical) variables even if it is called from outside the block where the variables were defined and it seems as though those variables should no longer be in scope. The subroutine clings to the lexical variables it references. Each time the subroutine is called via its reference, the same lexical variables are used. The lexical variables stay in scope until they are no longer being referenced.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa12"/>EXAMPLE 14.12</p>
<p class="codelink1"><a id="p14exa12" href="ch14_images.html#p14exa12a">Click here to view code image</a></p>
<p class="pre1">(The Script)<br/>1&#160;&#160;my $name="Tommy";<br/><br/>2&#160;&#160;{&#160;&#160;my $name = "Grandfather";&#160;&#160;# <span class="EmpItalic">Lexical variables</span><br/>3&#160;&#160;&#160;&#160;&#160;my $age = 86;<br/>4&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">$ref = sub{ return "$name is $age.\n"; }</span>&#160;&#160;# <span class="EmpItalic">Anonymous subroutine</span><br/>&#160;&#160;&#160;}<br/>5&#160;&#160;print "$name is back\n";<br/>6&#160;&#160;<span class="EmpStrong">print $ref-&gt;();</span>&#160;&#160;# <span class="EmpItalic">Call to subroutine outside the block</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Could also call subroutine with this syntax: &#38;{$ref};</span><br/><a id="page_479"/>(Output)<br/>5&#160;&#160;<span class="EmpItalic">Tommy is back.</span><br/>6&#160;&#160;<span class="EmpItalic">Grandfather is 86.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The lexical variable <em>$name</em> is assigned <em>Tommy</em>. The variable is visible from here to the end of the file.</p>
<p class="sb-indenthangingN"><strong>2.</strong> A block is entered. A new lexical variable, <em>$name,</em> is assigned <em>Grandfather</em>. It is visible from here to the end of its block.</p>
<p class="sb-indenthangingN"><strong>3.</strong> Another lexical variable, <em>$age</em>, is defined. It is visible from here to the end of the enclosing block.</p>
<p class="sb-indenthangingN"><strong>4.</strong> An anonymous subroutine is defined within the same block as the two lexical variables (<em>my</em> variables), <em>$name</em> and <em>$age</em>. The address of the subroutine is assigned to <em>$ref</em>. The subroutine has access to those variables even if it is called from outside the block. The subroutine is called a closure because the variables referenced within the subroutine are enclosed there until they are no longer needed.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The value of <em>$name</em>, <em>Tommy</em>, is now visible.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The anonymous subroutine is called via the pointer <em>$ref</em>. The lexical variables are still available even though they appear to be out of scope. They remain in scope because the reference still needs access to them. Perl doesn&#8217;t clean up the variables until they are no longer referenced.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa13"/>EXAMPLE 14.13</p>
<p class="codelink1"><a id="p14exa13" href="ch14_images.html#p14exa13a">Click here to view code image</a></p>
<p class="pre1">(The Script)<br/>&#160;&#160;&#160;# <span class="EmpItalic">Closure</span><br/>1&#160;&#160;sub paint {<br/>2&#160;&#160;&#160;&#160;&#160;my $color = shift;&#160;&#160;&#160;&#160;# <span class="EmpItalic">@_ array is shifted</span><br/>3&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $ref = sub</span> {&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Pointer to an anonymous subroutine</span><br/>4&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;my $object=shift;<br/>5&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "Paint the $object $color.\n"; # <span class="EmpItalic">$color still in scope</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>6&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">return $ref;</span>&#160;&#160;&#160;&#160;# <span class="EmpItalic">Returns a pointer (closure)</span><br/>&#160;&#160;&#160;}<br/><br/>7&#160;&#160;<span class="EmpStrong">my $p1</span>=paint("red"); # <span class="EmpItalic">$p1 is a pointer to anonymous subroutine</span><br/>&#160;&#160;&#160;<span class="EmpStrong">my $p2</span>=paint("blue");<br/>8&#160;&#160;<span class="EmpStrong">$p1-&gt;("flower");</span>&#160;&#160;# <span class="EmpItalic">Call to anonymous subroutine</span><br/>9&#160;&#160;<span class="EmpStrong">$p2-&gt;("sky");</span><br/>10 use Data::Dumper;<br/>&#160;&#160;&#160;<span class="EmpStrong">$Data::Dumper::Deparse=1;</span><br/><br/>11 print Dumper $p1, $p2;<br/><a id="page_480"/>(Output)<br/>5&#160;&#160;<span class="EmpItalic">Paint the flower red.</span><br/>5&#160;&#160;<span class="EmpItalic">Paint the sky blue.</span><br/>&#160;&#160;&#160;&#160;<span class="EmpItalic">&lt; Data::Dumper Output&gt;</span><br/>10 <span class="EmpItalic">$VAR1 = sub {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">my $object = shift();</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">print "Paint the $object $color.\n";</span><br/>&#160;&#160;&#160;<span class="EmpItalic">};</span><br/>&#160;&#160;&#160;<span class="EmpItalic">$VAR2 = sub {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">my $object = shift();</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">print "Paint the $object $color.\n";</span><br/>&#160;&#160;&#160;<span class="EmpItalic">};</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>paint()</em> subroutine is defined.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The lexical scalar <em>$color</em> is assigned the value shifted from the <em>@_</em> array.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The value in <em>$ref</em> is assigned an anonymous subroutine.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The anonymous subroutine takes one argument from the <em>@_</em> array. In this example, the value of <em>$object</em> will be <em>&#34;flower&#34;</em> the first time this subroutine is called, and <em>&#34;sky&#34;</em> the next time.</p>
<p class="sb-indenthangingN"><strong>5.</strong> Here is where we see a closure in action. The lexical variable <em>$color</em> is still in scope. The lexical variable <em>$color</em> doesn&#8217;t go out of scope even after the subroutine called <em>paint()</em> is called and exited, because the anonymous subroutine still needs it. <em>$color</em> is still available here even though the <em>paint()</em> function was called and exited.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The <em>paint()</em> subroutine returns a reference to the anonymous subroutine. The reference looks like this: <em>(CODE(0x100804ee8)).</em> The reference forms the closure; it keeps the lexical variables, in this case <em>$color</em>, around until no longer being referenced.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The <em>paint()</em> subroutine is called twice with different arguments. Each time <em>paint()</em> is called, Perl creates a new lexical scalar, <em>$color</em>, with its own value. The <em>$color</em> variable gets wrapped up in the closure that is returned. So <em>$p1</em> encloses one <em>$color</em>, which is initialized to <em>&#34;red&#34;</em>, and <em>$p2</em> encloses a totally different <em>$color</em>, initialized to <em>&#34;blue&#34;</em>. You can see that these variables get their own addresses, by printing <em>\$color</em> each time the function <em>paint()</em> is called to produce:</p>
<p class="pre1">&#160;&#160;&#160;&#160;&#160;&#160;SCALAR(0x7f947382db80)<br/>&#160;&#160;&#160;&#160;&#160;&#160;SCALAR(0x7f947382d4c0)</p>
<p class="sb-indenthangingN"><strong>8, 9.</strong> <em>$p1</em> and <em>$p2</em> are references to the anonymous subroutine defined on line 3. They have formed a &#8220;closure&#8221; around the variable <em>$color</em> defined in <em>paint()</em> and will have access to their own copy of that variable until it is no longer being referenced.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> We can use <em>Data::Dumper</em> to display the values of the code references, but unless we set the <em>$Data::Dumper::Deparse</em> variable to 1, the contents of an anonymous subroutine will be printed as <em>DUMMY</em>. <em>Data::Dumper</em> displays the contents of the anonymous subroutine.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec12"><a id="page_481"/>14.3.2 Closures and Objects</h4>
<p class="noindent">Closures provide a way to encapsulate the object&#8217;s data and thereby prevent the user from directly accessing the object. This can be done by defining the constructor with the object&#8217;s data and an anonymous subroutine that will act as the closure. The anonymous subroutine will be the only way to set and get data for the object. Instead of blessing the data (for example, anonymous hash into the class), the anonymous subroutine will be blessed. The reference to the anonymous subroutine will be returned and serve as the only way to access the private data defined in the constructor. The blessed anonymous subroutine will have access to the object&#8217;s data because it was declared within the same lexical scope. It encapsulates the data with the subroutine; thus, it forms a closure. As long as the anonymous subroutine refers to the object&#8217;s data, the data will be accessible.</p>
</div>
<p class="indent"><a href="ch14.html#ch14exa14">Example 14.14</a> demonstrates how to use a closure to encapsulate the data for an object by following these steps:</p>
<p class="indenthangingN"><strong>1.</strong> A constructor method is defined for a <em>Student</em> class. The constructor will define an empty anonymous hash that will be used to set properties for each new <em>Student</em> object, a global class variable to keep track of the number of students, and an anonymous subroutine to encapsulate the data to be assigned to and retrieved from the object. The blessing will return a pointer to the anonymous subroutine.</p>
<p class="indenthangingN"><strong>2.</strong> The instance methods will be defined for the object for setting and getting the data. Instead of getting back a pointer to the object&#8217;s data, these methods will get back a pointer to the anonymous subroutine. The only way they can access the data is by calling this anonymous subroutine with the appropriate arguments.</p>
<p class="indenthangingN"><strong>3.</strong> A destructor method will be defined to display each <em>Student</em> object as it is being destroyed.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa14"/>EXAMPLE 14.14</p>
<p class="codelink1"><a id="p14exa14" href="ch14_images.html#p14exa14a">Click here to view code image</a></p>
<p class="pre1"># <span class="EmpItalic">File is House.pm</span><br/><br/>&#160;&#160;&#160;package House;<br/><br/>1&#160;&#160;my @props=qw(Owner Color Price);&#160;&#160;# <span class="EmpItalic">Define property keys</span><br/><br/>2&#160;&#160;sub new{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($class)=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my @values=@_;&#160;&#160;# <span class="EmpItalic">Values for properties</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my %data;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Will store properties</span><br/>3&#160;&#160;&#160;&#160;&#160;@data{@props}=@values;&#160;&#160;# <span class="EmpItalic">Create the hash with keys and values</span><br/><br/>4&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $access_ptr = sub</span>{&#160;&#160;# <span class="EmpItalic">Anonymous subroutine</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "Caller is ",(caller)[0],"\n";<br/>5&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;my($access_type, $key, $value) = @_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Determines if setting or getting data</span><br/>6&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;die "Direct access not allowed" if caller() ne "House";<br/><a id="page_482"/>7&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ($access_type eq "set" &#38;&#38; $key eq "Price"){<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;die "Can't change Price\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br/>8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ($access_type eq "set"){<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$data{$key}=$value;&#160;&#160;# <span class="EmpItalic">Closure, %data still available here</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br/>9&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ($access_type eq "get"){<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return $data{$key};<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;&#160;&#160;&#160;};<br/>10&#160;&#160;&#160;&#160;<span class="EmpStrong">return bless( $access_ptr, $class)</span>;&#160;&#160;<span class="EmpItalic"># Bless anonymous sub</span><br/>&#160;&#160;&#160;}&#160;&#160;# <span class="EmpItalic">End new</span><br/><br/>11 sub set {<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($self, $key, $value)= @_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;("set", $key, $value);<br/>&#160;&#160;&#160;}<br/>12 sub get {<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($self, $key)= @_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;("get",$key);<br/>&#160;&#160;&#160;}<br/><br/>&#160;&#160;&#160;1;</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>House</em> class objects will have the properties, <em>Owner, Color,</em> and <em>Price</em>, assigned to the array <em>@props</em>.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The constructor will be used to create and bless the object. First the properties are set in a hash, the values supplied by the user.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The key/value pairs (properties) are assigned to the hash <em>%data</em>. This is an example of a hash slice.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The variable <em>$access_ref</em> is assigned a reference to an anonymous subroutine to serve as a closure. This subroutine will be blessed into the class and will be used to set and get the data for <em>House</em> objects. The user will use the reference to get access to the object&#8217;s data which is encapsulated within the function. The closure will allow access to the properties in <em>%data</em> even though it appears that <em>%data</em> should be out of scope.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The subroutine takes three arguments: the access type (which is <em>&#34;set&#34;</em> or <em>&#34;get&#34;)</em>, a key for the object, and a value for the object.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The Perl built-in function <em>caller()</em> returns the name of the package (class) from where the function was called. If the caller is trying to call this method from a package other than <em>House</em>, the error will be printed and the program will die. This will become clear later. For now, you cannot access the object&#8217;s data directly from the user program. You must access the data through methods defined by the class.</p>
<p class="sb-indenthangingN"><strong>7.</strong> If the access type is <em>&#34;set&#34;</em> and the key to the object is <em>&#34;Price&#34;</em>, then the user is not allowed to change the <em>Price</em> value and the program will die with the message.</p>
<p class="sb-indenthangingN"><a id="page_483"/><strong>8.</strong> If the access type is <em>&#34;set&#34;</em>, the value will be set for the object.</p>
<p class="sb-indenthangingN"><strong>9.</strong> If the access type is <em>&#34;get&#34;</em>, the value for the object will be retrieved.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The blessing returns a blessed reference to an anonymous subroutine to the user. In the previous examples, a blessed <em>HASH</em> was returned.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> This is the <em>set</em> method that will be called by the user. It serves as a wrapper function in that it doesn&#8217;t set the data itself, but makes it possible for the user to get access to the function that does. The first argument coming in is a reference to the anonymous subroutine, not a reference to a hash, array, scalar, but a reference to a subroutine! The second argument is a key for the object, and finally a value for the object. <em>$self</em>, then, is a reference to the anonymous subroutine that was blessed into the class on line 10, and when called, allows access to the object&#8217;s data.</p>
<p class="sb-indenthangingN1"><strong>12.</strong> The <em>get</em> method is similar to the <em>set</em> method in that it allows access to the object&#8217;s data by using the <em>$self</em> to call the anonymous subroutine that gets the data.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa15"/>EXAMPLE 14.15</p>
<p class="codelink1"><a id="p14exa15" href="ch14_images.html#p14exa15a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;# <span class="EmpItalic">User of the House Module</span><br/>1&#160;&#160;use House;&#160;&#160;# <span class="EmpItalic">Load the House module</span><br/><br/>2&#160;&#160;my $obj1 = House-&gt;new("John","red","10000");<br/>&#160;&#160;&#160;my $obj2 = House-&gt;new("Alice","green","20000");<br/><br/>3&#160;&#160;print "The owner of the first house is ", $obj1-&gt;get("Owner"),"\n";<br/>&#160;&#160;&#160;print "The owner of the second house is ", $obj2-&gt;get("Owner"),"\n";<br/><br/>4&#160;&#160;$obj1-&gt;set("Owner"=&gt;"Mary");<br/>&#160;&#160;&#160;$obj1-&gt;set("Style"=&gt;"ranch");<br/>&#160;&#160;&#160;print "After reset for Alice:\n";<br/>5&#160;&#160;print "Alice sold her house to ", $obj1-&gt;get("Owner"),"\n";<br/>6&#160;&#160;#$obj1-&gt;set("Price"=&gt;"50");&#160;&#160;&#160;# <span class="EmpItalic">Can't change price</span><br/>7&#160;&#160;#$ obj1-&gt;("set","Owner"=&gt;"Bank");&#160;&#160;# <span class="EmpItalic">Direct access not allowed</span><br/><br/>(Ouput)<br/>3&#160;&#160;<span class="EmpItalic">The owner of the first house is John</span><br/>&#160;&#160;&#160;<span class="EmpItalic">The owner of the second house is Alice</span><br/>5&#160;&#160;<span class="EmpItalic">After reset for Alice:</span><br/>6&#160;&#160;<span class="EmpItalic">Alice sold her house to Mary</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> Load the <em>House</em> module.</p>
<p class="sb-indenthangingN"><strong>2.</strong> Make two house objects and pass arguments to the constructor for each house. (The object for each house is a reference to a blessed anonymous subroutine.)</p>
<p class="sb-indenthangingN"><strong>3.</strong> Use the <em>get()</em> method to print the owner for the first and second house. A reference to the house object is passed as the first argument. The second argument is the key <em>&#34;Owner&#34;</em>. Its value is retrieved. (See line 9 in <em>House.pm</em>.)</p>
<p class="sb-indenthangingN"><a id="page_484"/><strong>4.</strong> The <em>set()</em> method in <em>House.pm</em> is called and sent a hash with a key and a value. (See line 11 in <em>House.pm</em>.)</p>
<p class="sb-indenthangingN"><strong>5.</strong> This line shows that the owner was reset by calling <em>$obj1</em>-<em>&gt;get(&#8220;Owner&#8221;)</em>.</p>
<p class="sb-indenthangingN"><strong>6.</strong> User cannot change the <em>Price</em> to $50.00. See line 7 in the <em>House.pm</em> module. This rogram will die if you try to reset the price.</p>
<p class="sb-indenthangingN"><strong>7.</strong> This is an attempt by the user to access the data directly by using the reference, <em>$obj1</em>, without calling the <em>set()</em> method provided by <em>House.pm</em>. If he does this, the <em>caller()</em> function (line 6 in <em>House.pm</em>) will return &#8220;main&#8221; if he is calling the function from his <em>main</em> package, causing an error message and the program to die. If he calls the <em>set()</em> method as <em>$obj1</em>-<em>&gt;set(&#8217;Owner&#8217;=&gt;&#8217;Bank&#8217;)</em> from the <em>House.pm</em> module, as he should, the <em>set()</em> method will call the anonymous subroutine, and now the <em>caller()</em> function will return <em>House</em>. Bottom line: if the caller isn&#8217;t a <em>House</em>, die.</p>
<hr/></div>
<div class="heading">
<h3 id="ch14lev1sec4">14.4 Inheritance</h3>
<p class="noindent"><strong>Inheritance</strong> means that a new class can inherit methods from an existing class. The new class can then add to or modify existing code in order to customize the class without having to reinvent what has already been done. The principle is that a class may be subdivided into a number of subclasses that all share common features, but each subclass may provide its own additional features, refining what it borrows to a more specific functionality. The idea of this kind of organization is not new. You may have seen it in a biology class when learning about the plant and animal kingdoms and the breakdown of each kingdom, phylum, class, order, family, genus, species, and variety or in procedural programs with the use of functions to combine the common elements of a program into specific tasks.</p>
</div>
<p class="indent">In object-oriented programming, once a class has been written and debugged, it can be stored in a library and reused by other programmers. The programmer can then add features and capabilities to the existing class without rewriting the whole thing. This is done through inheritance; that is, by deriving a new class from an already existing class. The reuse of software and the increased use of library classes where all this software is stored and organized have contributed to the wide popularity of OOP languages. Let&#8217;s see how Perl implements inheritance.</p>
<div class="heading">
<h4 id="ch14lev2sec13">14.4.1 The <em>@ISA</em> Array and Calling Methods</h4>
<p class="noindent">The classes (packages) listed in the <em>@ISA</em> array are the <strong>parent</strong>, or <strong>base</strong>, <strong>classes</strong> of the current class. This is how Perl implements inheritance. The <em>@ISA</em> array contains a list of packages (classes) where Perl will search for a method if it can&#8217;t find it in the current package <a id="page_485"/>(class). If the method still isn&#8217;t found, then Perl searches for an <em>AUTOLOAD</em> function and calls that method instead. And if that isn&#8217;t found, then Perl searches for the last time in a special predefined package called <em>UNIVERSAL</em>. The <em>UNIVERSAL</em> class is a global base class for all packages, the highest class in the hierarchy of classes.</p>
</div>
<p class="indent">The <em>@ISA</em> array is not searched in a call to a normal subroutine but in a call to a subroutine if it is called with the method invocation syntax.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa16"/>EXAMPLE 14.16</p>
<p class="codelink1"><a id="p14exa16" href="ch14_images.html#p14exa16a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;#!/bin/perl<br/>&#160;&#160;&#160;# <span class="EmpItalic">Example of attempting inheritance without updating</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">the @ISA array</span><br/>1&#160;&#160;{ <span class="EmpStrong">package Grandpa;</span><br/>2&#160;&#160;&#160;&#160;&#160;$name = "Gramps"; # <span class="EmpItalic">Global package variable for Grandpa</span><br/>3&#160;&#160;&#160;&#160;&#160;sub greetme {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">print "Hi $Child::name I'm your $name from package Grandpa.\n";</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/>4&#160;&#160;{ <span class="EmpStrong">package Parent;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">This package is empty</span><br/>&#160;&#160;&#160;}<br/>5&#160;&#160;{ <span class="EmpStrong">package Child;</span><br/>6&#160;&#160;&#160;&#160;&#160;$name = "Baby";<br/>7&#160;&#160;&#160;&#160;&#160;print "Hi I'm $name in the Child Package here.\n";<br/>8&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">Parent-&gt;greetme();</span>&#160;&#160;&#160;&#160;# <span class="EmpItalic">Use method invocation syntax</span><br/>&#160;&#160;&#160;}<br/><br/>(Output)<br/>7&#160;&#160;<span class="EmpItalic">Hi I'm Baby in the Child Package here.</span><br/>8&#160;&#160;<span class="EmpItalic">Can't locate object method "greetme" via package "Parent" at</span><br/>&#160;&#160;&#160;<span class="EmpItalic">inher2 line 23.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>Grandpa</em> is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The global scalar <em>$name</em> is assigned <em>Gramps</em> in package <em>Grandpa</em>.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The subroutine <em>greetme</em> is defined and when called, the <em>print</em> statement will be executed. <em>$Child::name</em> refers to the global scalar <em>$name</em> in the <em>Child</em> package.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The package <em>Parent</em> is declared. It is empty.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The package <em>Child</em> is declared. This package will try to call a method from another package. Although objects and methods aren&#8217;t being used here, the purpose of this example is to show you what happens if you try to inherit a method from a class that this package doesn&#8217;t know about.</p>
<p class="sb-indenthangingN"><strong>8.</strong> Perl can&#8217;t find the method <em>greetme</em> in package <em>Parent</em> and prints the error message.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_486"/><a id="ch14exa17"/>EXAMPLE 14.17</p>
<p class="codelink1"><a id="p14exa17" href="ch14_images.html#p14exa17a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;#!/bin/perl<br/>&#160;&#160;&#160;# <span class="EmpItalic">Example of attempting inheritance by updating the @ISA array</span><br/>1&#160;&#160;{ <span class="EmpStrong">package Grandpa;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Gramps";<br/>2&#160;&#160;&#160;&#160;&#160;sub greetme {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">print "Hi $Child::name I'm your $name from package Grandpa.\n";</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/><br/>3&#160;&#160;{ <span class="EmpStrong">package Parent;</span><br/>4&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">@ISA=qw(Grandpa);</span>&#160;&#160;# <span class="EmpItalic">Grandpa is a package in the @ISA array.</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">This package is empty.</span><br/>&#160;&#160;&#160;}<br/><br/>5&#160;&#160;{ <span class="EmpStrong">package Child;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Baby";<br/>6&#160;&#160;&#160;&#160;&#160;print "Hi I'm $name in the Child Package here.\n";<br/>7&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">Parent-&gt;greetme();</span>&#160;&#160;&#160;&#160;# <span class="EmpItalic">Parent::greetme() will not fail</span><br/>&#160;&#160;&#160;}<br/><br/>(Output)<br/>6&#160;&#160;<span class="EmpItalic">Hi I'm Baby in the Child Package here.</span><br/>7&#160;&#160;<span class="EmpItalic">Hi Baby I'm your Gramps from package Grandpa.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>Grandpa</em> is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The subroutine <em>greetme</em> is defined and, when called, the <em>print</em> statement will be executed. <em>$Child::name</em> refers to the scalar <em>$name</em> in the <em>Child</em> package.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The <em>Parent</em> package is declared.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>@ISA</em> array is assigned the name of the package <em>Grandpa</em>. Now if a method is called from this <em>Child</em> package and Perl can&#8217;t find it, it will try the <em>Grandpa</em> package listed in the <em>@ISA</em> array. If you try to call a normal subroutine without method invocation, Perl won&#8217;t consult the <em>@ISA</em> array, because it uses the <em>@ISA</em> array only when methods are being called. Even though the subroutines used here are not technically methods, by calling <em>greetme</em> as a class method, Perl will search the <em>@ISA</em> array.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The <em>Child</em> package is declared.</p>
<p class="sb-indenthangingN"><strong>6.</strong> This line will be printed from the <em>Child</em> package.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The class method <em>greetme</em> is called in the <em>Parent</em> package. The <em>@ISA</em> array tells Perl to look in the <em>Grandpa</em> package if the method isn&#8217;t in the <em>Parent</em> package.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec14">14.4.2 <em>$AUTOLOAD</em>, <em>sub AUTOLOAD</em>, and <em>UNIVERSAL</em></h4>
<p class="noindent">If a subroutine (or method) cannot be found in the current package or in the <em>@ISA</em> array, the <em>AUTOLOAD</em> function will be called. The <em>$AUTOLOAD</em> variable is assigned the name of the missing subroutine if it is used with the <em>AUTOLOAD</em> function. Arguments passed to the undefined subroutine are stored in the <em>AUTOLOAD</em> subroutine&#8217;s <em>@_</em> array. If you <a id="page_487"/>assign a function name to the <em>$AUTOLOAD</em> variable, that subroutine will be called if the <em>AUTOLOAD</em> subroutine is provided in place of the missing subroutine. If the <em>$AUTOLOAD</em> variable is used with the <em>AUTOLOAD</em> subroutine, either the method or regular subroutine syntax can be used. If all fails and Perl still can&#8217;t find the subroutine, a final package (class) called <em>UNIVERSAL</em> is searched for the missing method. The <em>UNIVERSAL</em> class contains three methods that all classes inherit. They are <em>isa()</em>, <em>can()</em>, and <em>VERSION()</em> (see <a href="ch14.html#ch14tab02">Table 14.2</a>). Type at your command line prompt <em>perldoc UNIVERSAL</em> for most recent documentation.</p>
</div>
<div class="tab-heading">
<div class="image"><a id="ch14tab02"/><img src="graphics/14tab02.jpg" alt="Image"/></div>
<p class="tab-caption"><strong>Table 14.2</strong> The <em>isa()</em>, <em>can()</em>, and <em>VERSION()</em> Methods</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa18"/>EXAMPLE 14.18</p>
<p class="codelink1"><a id="p14exa18" href="ch14_images.html#p14exa18a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;{ <span class="EmpStrong">package Grandpa;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Gramps";<br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">sub greetme {</span><br/>2&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">print "Hi $Child::name I'm your $name from package Grandpa.\n";</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">}</span><br/>&#160;&#160;&#160;}<br/><br/>3&#160;&#160;{ <span class="EmpStrong">package Parent;</span><br/>4&#160;&#160;&#160;&#160;&#160;sub AUTOLOAD{<br/>5&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "<span class="EmpStrong">$_[0]</span>: $_[1] and $_[2]\n";<br/>6&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "You know us after all!\n";<br/>7&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "The unheard of subroutine is called <span class="EmpStrong">$AUTOLOAD</span>.\n"<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/>8&#160;&#160;{ <span class="EmpStrong">package Child;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Baby";<br/>9&#160;&#160;&#160;&#160;&#160;print "Hi I'm $name in the Child Package here.\n";<br/>10&#160;&#160;&#160;&#160;<span class="EmpStrong">Parent-&gt;unknown("Mom", "Dad");</span>&#160;&#160;&#160;# <span class="EmpItalic">Undefined subroutine</span><br/>&#160;&#160;&#160;}<br/><br/>(Output)<br/>2&#160;&#160;<span class="EmpItalic">Hi Baby I'm your Gramps from package Grandpa.</span><br/>9&#160;&#160;<span class="EmpItalic">Hi I'm Baby in the Child Package here.</span><br/>5&#160;&#160;<span class="EmpItalic">Parent: Mom and Dad</span><br/>6&#160;&#160;<span class="EmpItalic">You know us after all!</span><br/>7&#160;&#160;<span class="EmpItalic">The unheard of subroutine is called Parent::unknown.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_488"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>Grandpa i</em>s declared. It contains one subroutine.</p>
<p class="sb-indenthangingN"><strong>2.</strong> This line is printed from the <em>Grandpa</em> package.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The package <em>Parent</em> is declared.</p>
<p class="sb-indenthangingN"><strong>4.</strong> It contains an <em>AUTOLOAD</em> subroutine. An undefined subroutine is called on line 10. It has two arguments, <em>Mom</em> and <em>Dad</em>. If Perl can&#8217;t find this subroutine in the <em>Child</em> package, it will look in the <em>@ISA</em> array, and if it is not there, Perl will look for an <em>AUTOLOAD</em> function.</p>
<p class="sb-indenthangingNP">The subroutine <em>AUTOLOAD</em> is defined.</p>
<p class="sb-indenthangingN"><strong>5.</strong> Since this function was called as a class method, the first argument stored in the <em>@_</em> array is the name of the class. The remaining arguments are <em>Mom</em> and <em>Dad</em>.</p>
<p class="sb-indenthangingN"><strong>6.</strong> This line is printed to show that we got here.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The <em>$AUTOLOAD</em> variable contains the name of the class and the unnamed subroutine.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The package <em>Child</em> is declared.</p>
<p class="sb-indenthangingN"><strong>9.</strong> This line is printed to show in what order the lines are executed.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The <em>Child</em> package wants to access a method in the <em>Parent</em> package. The <em>Parent</em> package does not contain a method or subroutine called <em>unknown</em>. It does, on the other hand, contain an <em>AUTOLOAD</em> subroutine that will be executed because this subroutine can&#8217;t be found.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa19"/>EXAMPLE 14.19</p>
<p class="codelink1"><a id="p14exa19" href="ch14_images.html#p14exa19a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;{ <span class="EmpStrong">package Grandpa;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Gramps";<br/>2&#160;&#160;&#160;&#160;&#160;sub greetme {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "Hi $Child::name I'm your $name from package Grandpa.\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/>3&#160;&#160;{ <span class="EmpStrong">package Parent;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">This package is empty</span><br/>&#160;&#160;&#160;}<br/>4&#160;&#160;{ <span class="EmpStrong">package Child;</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$name = "Baby";<br/>5&#160;&#160;&#160;&#160;&#160;print "Hi I'm $name in the Child Package here.\n";<br/>6&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">Parent-&gt;greetme();</span><br/>&#160;&#160;&#160;}<br/><br/>7&#160;&#160;<span class="EmpStrong">package UNIVERSAL;</span><br/>8&#160;&#160;<span class="EmpStrong">sub AUTOLOAD {</span><br/>9&#160;&#160;&#160;&#160;&#160;print "The UNIVERSAL lookup package.\n";<br/>10&#160;&#160;&#160;&#160;<span class="EmpStrong">Grandpa-&gt;greetme();</span><br/>&#160;&#160;&#160;}<br/><br/>(Output)<br/>2&#160;&#160;<span class="EmpItalic">Hi I'm Baby in the Child Package here.</span><br/>9&#160;&#160;<span class="EmpItalic">The UNIVERSAL lookup package.</span><br/>5&#160;&#160;<span class="EmpItalic">Hi Baby I'm your Gramps from package Grandpa.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_489"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The package <em>Grandpa</em> is declared.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The subroutine <em>greetme</em> is defined in this package.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The package <em>Parent</em> is declared. It is empty.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The package <em>Child</em> is declared.</p>
<p class="sb-indenthangingN"><strong>5.</strong> This line is printed to show the flow of execution in the program.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The <em>greetme</em> subroutine is called as one of the <em>Parent</em> package methods. Since the method could not be found in its own class or in the <em>@ISA</em> array, and an <em>AUTOLOAD</em> function is not supplied in the <em>Parent</em> package, Perl looks for package <em>UNIVERSAL</em> as a last resort.</p>
<p class="sb-indenthangingN"><strong>7.</strong> This is the built-in base class called <em>UNIVERSAL</em> All modules inherit from <em>UNIVERSAL</em> which is implicitly on the end of the <em>@ISA</em> array.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The <em>AUTOLOAD</em> function will automatically be called from the <em>UNIVERSAL</em> class.</p>
<p class="sb-indenthangingN2"><strong>9, 10.</strong> Within the <em>AUTOLOAD</em> function, the <em>greetme()</em> function in the <em>Grandpa</em> package will be invoked.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec15">14.4.3 Derived Classes</h4>
<p class="noindent">As already discussed, <strong>inheritance</strong> is when one class can inherit methods from an existing class. The existing class is called the <strong>base</strong>, <strong>parent</strong>, or <strong>superclass</strong>, and the new class that inherits from it is called the <strong>derived</strong>, <strong>child</strong>, or <strong>subclass.</strong> The base class has capabilities that all its derived classes inherit, and the derived class can then go beyond those capabilities.</p>
</div>
<p class="indent">If a derived class inherits from one base class, it is called <strong>single inheritance</strong>. For example, single inheritance in real life might be that a child inherits his ability to draw from his father. If a derived or subclass inherits from more than one base class, this is called <strong>multiple inheritance</strong>. To continue the analogy, the child inherits his ability to draw from his father and his ability to sing from his mother. In Perl, the derived class inherits methods from its base class and can add and modify these methods when necessary.</p>
<p class="indent">The classes are inherited by putting them in the <em>@ISA</em> array. In <a href="ch13.html#ch13">Chapter 13</a>, &#8220;<a href="ch13.html#ch13">Modularize It, Package It, and Send It to the Library!</a>&#8221; we looked at modules from the Perl standard library and modules you could create yourself. In order to include a module or pragma into your program, the <em>use</em> function was called with the module name (minus the.<em>pm</em> extension). The module had the capability of exporting symbols to other packages that might need to use the module. A special module called <em>Exporter.pm</em> handled the details for exporting and importing symbols between modules and the symbols were listed in the <em>@EXPORT</em> and <em>@EXPORT_OK</em> arrays. The <em>Exporter.pm</em> module, you may recall, was listed in the <em>@ISA</em> array in order to inherit methods necessary for it to do its job. But if a module functions as a class, then its methods can be called without using <em>Exporter</em>. Note in the following examples, the class methods and the instance methods are not exported.</p>
<p class="indent">The following examples demonstrate inheritance. The user program need not make any reference to the base class, <em>Employee.</em> The <em>Salesman</em> class and the <em>Teacher</em> class are derived from <em>Employee</em>. The <em>Salesman</em> and <em>Teacher</em> class &#8220;use&#8221; the <em>Employee</em> class. <a href="ch14.html#ch14fig05">Figure 14.5</a> shows this inheritance hierarchy graphically.</p>
<div class="fig-heading">
<div class="image"><a id="page_490"/><a id="ch14fig05"/><img src="graphics/14fig05.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.5</strong> Inheritance hierarchy&#8212;deriving classes from a base class.</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa20"/>EXAMPLE 14.20</p>
<p class="codelink1"><a id="p14exa20" href="ch14_images.html#p14exa20a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;# <span class="EmpItalic">Module Employee.pm</span><br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">The Base Class</span><br/>1&#160;&#160;<span class="EmpStrong">package Employee;</span><br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>&#160;&#160;&#160;# <span class="EmpItalic">Constructor method</span><br/>2&#160;&#160;<span class="EmpStrong">sub init</span> {<br/>3&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>4&#160;&#160;&#160;&#160;&#160;my %info = @_;<br/>5&#160;&#160;&#160;&#160;&#160;my $self = {_Name=&gt;$info{"_Name"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_StartDate=&gt;$info{"_StartDate"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_BasePay=&gt;$info{"_BasePay"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/>6&#160;&#160;&#160;&#160;&#160;return bless($self, $class);<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;# <span class="EmpItalic">Some instance methods</span><br/>&#160;&#160;&#160;sub get_name{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{_Name};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;&#160;sub get_startdate{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{_StartDate};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;sub get_basepay{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $self-&gt;{_BasePay};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_491"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> <em>Employee</em> is the base class in a file called <em>Employee.pm</em>.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>init</em> method is a constructor. It sets properties for all employees.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The first argument is the class name from which the method was called.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The information being passed in from the caller of this function is a hash of key/value pairs.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The values in the <em>%info</em> hash are assigned as the employee&#8217;s properties.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The new employee referent is blessed into the class that called this subroutine (its name was passed in as the first argument).</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa21"/>EXAMPLE 14.21</p>
<p class="codelink1"><a id="p14exa21" href="ch14_images.html#p14exa21a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;package Salesman;<br/>&#160;&#160;&#160;use lib("/usr/local/bin/baseclass");&#160;&#160;# <span class="EmpItalic">Update @INC</span><br/>&#160;&#160;&#160;use v5.10.0;<br/>&#160;&#160;&#160;use feature qw(state say);<br/>2&#160;&#160;use base qw(Employee);&#160;&#160;# <span class="EmpItalic">Updates @ISA</span><br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>3&#160;&#160;sub count_salesman{&#160;&#160;&#160;# <span class="EmpItalic">Class method</span><br/>4&#160;&#160;&#160;&#160;&#160;state $counter=0;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$counter++;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $counter;<br/>&#160;&#160;&#160;}<br/>5&#160;&#160;sub new&#160;&#160;{&#160;&#160;# <span class="EmpItalic">Constructor for Salesman</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($class)= shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my %data=@_;<br/>6&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $emp = $class-&gt;init("_Name"=&gt;$data{_Name},</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_StartDate"=&gt;$data{_StartDate},</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_BasePay"=&gt;$data{_BasePay},</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br/>7&#160;&#160;&#160;&#160;&#160;$emp-&gt;{"_AnnualSales"}=$data{"_AnnualSales"};<br/>&#160;&#160;&#160;&#160;&#160;&#160;$emp-&gt;{"_Commission"}=$data{"_Commission"};<br/>8&#160;&#160;&#160;&#160;&#160;say "This is $emp-&gt;{_Name}, salesman #", count_salesman();<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $emp;<br/>&#160;&#160;&#160;}<br/>9&#160;&#160;sub calculate_pay{<br/>10&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $rate = $self-&gt;{"_Commission"};<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $sales = $self-&gt;{"_AnnualSales"};<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $base = $self-&gt;{"_BasePay"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $pay = $sales * $rate + $base;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $pay;<br/>&#160;&#160;&#160;}<br/>11 sub DESTROY{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "$self-&gt;{_Name} is leaving the firm.\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_492"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>Salesman</em> class is declared in <em>Salesman.pm</em>.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>base</em> module updates the <em>@ISA</em> array and loads the <em>Employee.pm</em> module. Another way to update <em>@ISA</em> is to say:</p>
<p class="pre2">push(@ISA,"Employee");<br/>use Employee;</p>
<p class="sb-indenthangingNP">If using version 5.16 and above, you can say:</p>
<p class="pre2">use parent Employee;</p>
<p class="sb-indenthangingN4"><strong>3, 4.</strong> The counter subroutine will keep track of the number of salesmen created. It uses the <em>state</em> feature to allow the <em>$counter</em> variable to retain its value from one call to the next; meaning, it does not reset the variable to zero each time the function is called. This is a class function as it is specific to the class as a whole and does not take a reference to an object as its first argument.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The constructor method for the <em>Salesman</em> class is defined.</p>
<p class="sb-indenthangingN"><strong>6.</strong> Here we see inheritance being used when calling the <em>init</em> method which is defined in the <em>Employee</em> class (see <em>Employee.pm</em>), not in the current <em>Salesman</em> class. When <em>init</em> is called, Perl will look in the current <em>Salesman</em> class first, and since it is not defined there, will then look in the <em>@ISA</em> array to see if it is listed there. It is. Note that the class name being sent to to the <em>Employee</em>&#8217;s <em>init()</em> function is <em>Salesman</em> (meaning, in the <em>Employee</em> class the blessing will bless the object into the <em>Salesman</em> class, not the <em>Employee</em> class). The remaining arguments are the properties for any <em>Employee</em>. A blessed reference to a new <em>Salesaman</em> object is returned.</p>
<p class="sb-indenthangingN"><strong>7.</strong> Now the blessed salesman will get additional properties that further define all salesmen.</p>
<p class="sb-indenthangingN"><strong>8.</strong> Each time a new <em>Salesman</em> object is created, the <em>count_salesman</em> function is called. It is a class function and does not require a reference to the object.</p>
<p class="sb-indenthangingN"><strong>9.</strong> An access method, <em>calculate_pay()</em>, is defined for the <em>Salesman</em>.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The first argument is a reference to the object implicitly sent by Perl when the function is called.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> The <em>DESTROY</em> method is called each time an object goes out of scope, usually when the program ends.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa22"/>EXAMPLE 14.22</p>
<p class="codelink1"><a id="p14exa22" href="ch14_images.html#p14exa22a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;<span class="EmpStrong">package Teacher</span>;<br/>&#160;&#160;&#160;use v5.10.0;<br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>&#160;&#160;&#160;use feature qw(state say);<br/>2&#160;&#160;<span class="EmpStrong">our @ISA=qw(Employee)</span>;<br/>&#160;&#160;&#160;<span class="EmpStrong">use Employee</span>;<br/><br/>&#160;&#160;&#160;my $tracker;<br/><a id="page_493"/>3&#160;&#160;sub count_teacher{&#160;&#160;&#160;# <span class="EmpItalic">Class method</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;state $counter=0;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$counter++;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $counter;<br/>&#160;&#160;&#160;}<br/>4&#160;&#160;sub new&#160;&#160;{&#160;&#160;# <span class="EmpItalic">Constructor for Teacher</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($class)= shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my %data=@_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $emp = $class-&gt;init("_Name"=&gt;$data{_Name},<br/>5&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_StartDate"=&gt;$data{_StartDate},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"_BasePay"=&gt;$data{_BasePay},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br/>&#160;&#160;&#160;&#160;&#160;&#160;$tracker=count_teacher();<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $emp;<br/>&#160;&#160;&#160;}<br/>6&#160;&#160;<span class="EmpStrong">sub set_courses</span>{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $cptr=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{"_Courses"}=$cptr;<br/>&#160;&#160;&#160;}<br/>7&#160;&#160;sub get_courses{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self=shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return "@{$self-&gt;{'_Courses'}}";<br/>&#160;&#160;&#160;}<br/><br/>8&#160;&#160;<span class="EmpStrong">END</span>{<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "$tracker teachers were created.\n";<br/>&#160;&#160;&#160;}</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>Teacher</em> class is defined here.</p>
<p class="sb-indenthangingN"><strong>2.</strong> In this module, the <em>@ISA</em> is updated directly rather than by using the <em>base.pm</em> or <em>parent.pm</em> pragmas. The name of the base class is listed so that the subclass, <em>Teacher</em>, can inherit from it. Not only does the <em>@ISA</em> array need to be updated, but the <em>use</em> directive must name the base class and load it. This is done automatically when you say <em>use parent</em> or <em>use base</em>.</p>
<p class="sb-indenthangingN"><strong>3.</strong> This class function will track the number of new <em>Teacher</em> objects added to the class.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>new()</em> constructor method for the teacher defines the properties for the teacher as a hash and returns a blessed teacher reference.</p>
<p class="sb-indenthangingN"><strong>5.</strong> Like the <em>Salesman</em> class described previously, the <em>Teacher</em> inherits from the <em>Employee</em> class and call its <em>init()</em> method. The <em>init()</em> constructor in the <em>Employee</em> class will then assign the basic properties for an <em>Employee</em> and return a blessed <em>Teacher</em> object.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The teacher object is sent to the <em>set_courses()</em> method along with a reference to a list of courses. These courses will be set as a new attribute to the object.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The <em>get_courses()</em> method will retrieve and send back the list of the teacher&#8217;s courses by derefencing the pointer, <em>$self-&gt;{Courses}</em>.</p>
<p class="sb-indenthangingN"><a id="page_494"/><strong>8.</strong> When the program is is ready to exit, the special <em>END</em> subroutine prints out the number of <em>Teacher</em> objects that were created. This works better than using the <em>DESTROY</em> method because the <em>DESTROY</em> method would print out the message whenever a teacher object goes out of scope, so that if you had created six teacher objects, the message would print six times.</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa23"/>EXAMPLE 14.23</p>
<p class="codelink1"><a id="p14exa23" href="ch14_images.html#p14exa23a">Click here to view code image</a></p>
<p class="pre1">&#160;&#160;&#160;# <span class="EmpItalic">The Driver (user) Program</span><br/>1&#160;&#160;use Salesman;<br/>2&#160;&#160;use Teacher;<br/>&#160;&#160;&#160;use Data::Dumper;<br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>3&#160;&#160;<span class="EmpStrong">my $salesguy1=Salesman-&gt;new("_Name"=&gt;"Nicky McDonald",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_StartDate"=&gt;"12/12/2010",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_BasePay"=&gt;25000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_AnnualSales"=&gt;1200,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_Commission"=&gt;.05,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">);</span><br/>4&#160;&#160;my $pay=$salesguy1-&gt;calculate_pay();<br/>&#160;&#160;&#160;printf "$salesguy1-&gt;{_Name} made \$%.2f last year.\n\n", $pay;<br/><br/>5&#160;&#160;<span class="EmpStrong">my $salesguy2=Salesman-&gt;new("_Name"=&gt;"Rick Gonzales",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_StartDate"=&gt;"12/12/2010",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_BasePay"=&gt;80000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_AnnualSales"=&gt;12200,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_Commission"=&gt;.08,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">);</span><br/>6&#160;&#160;$pay=$salesguy2-&gt;calculate_pay;<br/>&#160;&#160;&#160;printf "$salesguy2-&gt;{_Name} made \$%.2f last year.\n\n", $pay;<br/><br/>7&#160;&#160;<span class="EmpStrong">my $teacher=Teacher-&gt;new("_Name"=&gt;"Charles Lee",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_StartDate"=&gt;"08/12/2013",</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">"_BasePay"=&gt;55000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">);</span><br/><br/>8&#160;&#160;<span class="EmpStrong">$teacher-&gt;set_courses(["Basic Math", "Algebra", "Calculus"]);</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">Pass ref to Array of courses</span><br/>&#160;&#160;&#160;print $teacher-&gt;get_name,"\n";&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Inheritance</span><br/>&#160;&#160;&#160;print $teacher-&gt;get_startdate,"\n"; # <span class="EmpItalic">Inheritance</span><br/>&#160;&#160;&#160;print $teacher-&gt;get_basepay,"\n" ;&#160;&#160;# <span class="EmpItalic">Inheritance</span><br/>&#160;&#160;&#160;print $teacher-&gt;get_courses,"\n";&#160;&#160;&#160;# <span class="EmpItalic">Teacher's access method</span><br/><br/>&#160;&#160;&#160;$Data::Dumper::Varname="employee";&#160;&#160;# <span class="EmpItalic">Give Dumper a user-defined</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">variable name</span><br/>9&#160;&#160;print Dumper($salesguy1, $teacher); # <span class="EmpItalic">Dump out data for two objects</span><br/><a id="page_495"/><span class="EmpItalic">(Output)</span><br/>&#160;&#160;&#160;<span class="EmpItalic">This is Nicky McDonald, salesman #1</span><br/><br/>&#160;&#160;&#160;<span class="EmpItalic">Nicky McDonald made $25060.00 last year.</span><br/><br/>&#160;&#160;&#160;<span class="EmpItalic">This is Rick Gonzales, salesman #2</span><br/><br/>&#160;&#160;&#160;<span class="EmpItalic">Rick Gonzales made $80976.00 last year.</span><br/><br/>&#160;&#160;&#160;<span class="EmpItalic">Charles Lee</span><br/>&#160;&#160;&#160;<span class="EmpItalic">08/12/2013</span><br/>&#160;&#160;&#160;<span class="EmpItalic">55000</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Basic Math Algebra Calculus</span><br/>&#160;&#160;&#160;<span class="EmpItalic">$employee1 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_AnnualSales' =&gt; 1200,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_BasePay' =&gt; 25000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_Commission' =&gt; '0.05',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_StartDate' =&gt; '12/12/2010',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_Name' =&gt; 'Nicky McDonald'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'Salesman' );</span><br/>&#160;&#160;&#160;<span class="EmpItalic">$employee2 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_BasePay' =&gt; 55000,</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_StartDate' =&gt; '08/12/2013',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_Courses' =&gt; [</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Basic Math',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Algebra',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'Calculus'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">],</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'_Name' =&gt; 'Charles Lee'</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'Teacher' );</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Rick Gonzales is leaving the firm.</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Nicky McDonald is leaving the firm.</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">1 teachers were created.</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>Salesman</em> class is loaded into memory.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>Teacher</em> class is also loaded into memory.</p>
<p class="sb-indenthangingN"><strong>3.</strong> A new <em>Salesman</em> object is created with a call to the new constructor. The properties are sent as a hash. In this way the properties can be sent in any order, because both key and value are sent.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>Salesman&#8217;s</em> instance/access method, <em>calculate_pay</em>, is called and returns the object&#8217;s pay.</p>
<p class="sb-indenthangingN"><strong>5.</strong> Another <em>Salesman</em> object is created.</p>
<p class="sb-indenthangingN"><strong>6.</strong> Pay for the second <em>Salesman</em> object is calculated and returned.</p>
<p class="sb-indenthangingN"><strong>7.</strong> A new <em>Teacher</em> object is created. Because the classname for a <em>Teacher</em> class is the first argument, the <em>new()</em> constructor for the <em>Teacher</em> is called (polymorphism in action).</p>
<p class="sb-indenthangingN"><a id="page_496"/><strong>8.</strong> The teacher&#8217;s access method, <em>set_courses</em>(), is called. Its arguments are the object reference, implicitly sent by Perl, and a reference to an array of courses. These courses will be added as another attribute for the <em>Teacher</em>. In the next lines, the values are fetched using the base class methods (inherited) and the <em>Teacher</em>&#8217;s method.</p>
<p class="sb-indenthangingN"><strong>9.</strong> The data for two employees, the first salesman and teacher, are displayed by <em>Data::Dumper</em>. You can see that each employee was blessed into his respective class.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec16">14.4.4 Multiple Inheritance and Roles with Moose</h4>
<p class="noindent">When a class inherits methods from more than one base, or parent, class, it is called <strong>multiple inheritance</strong>. In Perl, multiple inheritance is accomplished by adding more than one class to the <em>@ISA</em> array.</p>
</div>
<p class="codelink"><a id="p596pro01" href="ch14_images.html#p596pro01a">Click here to view code image</a></p>
<p class="pre">package&#160;&#160;Child;<br/>our @ISA = qw (Mother Father Teacher);</p>
<p class="indent">The search is depth-first, meaning that Perl will search for classes in <em>Mother</em> and the hierarchy of classes it descends from, then <em>Father</em> and the hierarchy of classes it descends from, and finally <em>Teacher</em> and all its ancestors. Just as in real life, the hierarchy can get confusing when there are multiple parents on the family tree.</p>
<p class="indent">Roles are an alternative to multiple inheritance. Similar to <em>Java</em> interfaces, or Smalltalk traits, a role defines a set of methods or attributes for a class that must be implemented by the class and can be shared by other classes. A role itself is not a class. From the Moose manual on describing roles:</p>
<p class="blockquote">A role is <em>composed</em> into a class. In practical terms, this means that all of the methods, method modifiers, and attributes defined in a role are added directly to (we sometimes say &#8220;flattened into&#8221;) the class that consumes the role. These attributes and methods then appear as if they were defined in the class itself. A subclass of the consuming class will inherit all of these methods and attributes.</p>
<p class="indent">For example, if a <em>Guard</em> class and a <em>Researcher</em> class are extended from the <em>Employee</em> class we created earlier, and these two classes require a method to get a security clearance, you could use multiple inheritance and inherit from both the <em>Employee</em> and a <em>Clearance</em> class. But inheritance is an &#8220;is a&#8221; relationship where the derived class is a specialization of the parent class. You can say a <em>Guard</em> &#8220;is a&#8221; <em>Employee</em>, but he is not a <em>Clearance</em>. It&#8217;s more that a <em>Guard</em> requires a clearance. Not every employee needs a clearance, but some do. Our <em>Salesman</em> didn&#8217;t need one. Creating a role would better satisfy this requirement for those classes that need it. A role allows one class to consist of or consume a role to make it complete. For example, a <em>Guard</em> and a <em>Salesman</em> inherit from the <em>Employee</em> class all those basic requirements of an employee, but the <em>Guard</em> class isn&#8217;t complete until it gets a <em>Clearance</em> while the <em>Salesman</em> doesn&#8217;t need one. We can create a role that does the job. Roles are a &#8220;does a&#8221; relationship, rather than an &#8220;is a&#8221; relationship.</p>
<p class="indent"><a id="page_497"/>Since Perl does not implement a built-in way to create roles, there are a number of modules in the Perl library that support them. The most popular is the Moose module, which is an extension of the Perl 5 object system. Try <em>perldoc Moose</em> for complete documentation. Examples of using Moose are found in <a href="app03.html#app03">Appendix C</a>, &#8220;<a href="app03.html#app03">Introduction to Moose (A Postmodern Object System for Perl 5)</a>.&#8221; There is also a subset of Moose called Moo that may be better for optimized rapid startup. (See <em><a href="http://perlmaven.com/videos/oop-with-moo">http://perlmaven.com/videos/oop-with-moo</a>.</em>) Another watered-down version of Moose is the <em>Role::Tiny</em> module described in its documentation &#8220;like a nouvelle cuisine portion size slice of Moose.&#8221;</p>
<p class="indent">In the following example, we demonstrate how to create and use a role with <em>Moose::Role</em>. In this example, we define a package called <em>Radius</em>. The class is a <em>Shape::Circle</em>. The <em>Circle</em> class will have a <em>color</em> property and a <em>calculate_area</em> method. In order to get the area of a circle, it must have a radius. If we provide a <em>setRadius</em> method in the <em>Circle</em>, and then if we want to create a sphere or a cone object, we would still be required to set the radius for those objects. If we put it in an inheritance tree, we could say a <em>Circle</em> is a <em>Shape</em>, and a <em>Rectangle</em> is a <em>Shape</em>, but only the <em>Circle</em> requires a radius. So with role composition, any object that requires a radius can share the <em>Radius</em> role to define the <em>setRadius</em> and <em>getRadius</em> methods or simply ensure a <em>setRadius</em> method is implemented in the module. If it is not, Perl will throw an exception. Using the <em>Moose::Role</em> module, we create a role like an ordinary module in a <em>.pm</em> file with a package declaration and then assign the attributes and methods that the using module will &#8220;consume.&#8221; Moose roles are not classes and cannot be instantiated. They are simply roles.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa24"/>EXAMPLE 14.24</p>
<p class="codelink1"><a id="p14exa24" href="ch14_images.html#p14exa24a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;package Radius;<br/><br/>2&#160;&#160;<span class="EmpStrong">use Moose::Role</span>;&#160;&#160;&#160;# <span class="EmpItalic">Automatically turns on strict and warnings</span><br/><br/>3&#160;&#160;has 'radius' =&gt; (&#160;&#160;# <span class="EmpItalic">Attributes and accessors</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;is =&gt; 'rw',<br/>&#160;&#160;&#160;&#160;&#160;&#160;isa =&gt; 'Int',<br/>&#160;&#160;&#160;&#160;&#160;&#160;required =&gt; 1,<br/>&#160;&#160;&#160;)<br/>&#160;&#160;&#160;1;<br/><br/>4&#160;&#160;package Shape::Circle;<br/>&#160;&#160;&#160;use Math::Trig;<br/>5&#160;&#160;<span class="EmpStrong">use Moose;</span><br/>&#160;&#160;&#160;<span class="EmpStrong">with 'Radius'</span>;&#160;&#160;# <span class="EmpItalic">Radius is a Role</span><br/><br/>6&#160;&#160;has 'color'=&gt;(&#160;&#160;# <span class="EmpItalic">Define</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;is =&gt; 'rw',<br/>&#160;&#160;&#160;&#160;&#160;&#160;isa =&gt; 'Str',<br/>&#160;&#160;&#160;&#160;&#160;&#160;default =&gt; 'blue'<br/>&#160;&#160;&#160;);<br/><a id="page_498"/>7&#160;&#160;sub calculate_area{&#160;&#160;# <span class="EmpItalic">Define method for Circle uses radius</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $area=$self-&gt;{'radius'} ** 2 * pi;<br/>&#160;&#160;&#160;&#160;&#160;&#160;return $area;<br/>&#160;&#160;&#160;}<br/><br/>&#160;&#160;&#160;package main;<br/>&#160;&#160;&#160;use Data::Dumper;<br/><br/>8&#160;&#160;<span class="EmpStrong">my $c1=Shape::Circle-&gt;new('radius' =&gt; 6);</span>&#160;&#160;# <span class="EmpItalic">Required argument</span><br/>9&#160;&#160;print Dumper $c1;&#160;&#160;# <span class="EmpItalic">See the new Circle object</span><br/>10 <span class="EmpStrong">$c1-&gt;radius(3);</span>&#160;&#160;&#160;&#160;# <span class="EmpItalic">radius is a setter</span><br/>11 print "The radius is ", <span class="EmpStrong">$c1-&gt;radius;</span>&#160;&#160;# <span class="EmpItalic">radius is a getter</span><br/>12 printf "The area is %.2f\n ",&#160;&#160;<span class="EmpStrong">$c1-&gt;calculate_area;</span><br/>13 print Dumper $c1;<br/><br/>(Output)<br/>9&#160;&#160;$<span class="EmpItalic">VAR1 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'color' =&gt; 'blue',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'radius' =&gt; 6</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'Shape::Circle' );</span><br/>11 <span class="EmpItalic">The radius is 3</span><br/>12 The area is 28.27<br/>13 <span class="EmpItalic">$VAR1 = bless( {</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'color' =&gt; 'blue',</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">'radius' =&gt; 3</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">}, 'Shape::Circle' );</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> <em>Radius.pm</em> serves as a Moose role. It can be used, or &#8220;consumed,&#8221; by any class that requires a radius.</p>
<p class="sb-indenthangingN"><strong>2.</strong> <em>Moose::Role</em> is an extension of the Moose module. (You may have to download Moose if you are using a version of Perl prior to 5.16.)</p>
<p class="sb-indenthangingN"><strong>3.</strong> The <em>Role</em> has an attribute called <em>&#39;radius&#39;</em> that takes an integer for its value, is readable and writeable (<em>rw</em>), and requires that a value for the radius be provided as an argument to the constructor of the &#8220;consuming&#8221; class. When a class &#8220;consumes&#8221; a role, it means that all the methods and attributes defined here in this role, are added directly to that class as though the class itself defined them. Moose automatically creates a constructor and setter and getter accessor methods (called <em>&#39;radius&#39;</em>) for the consuming class.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>Shape::Circle</em> class is declared.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The <em>Shape::Circle</em> class will &#8220;consume&#8221; the <em>Radius</em> role. The <em>with</em> function is used to import or compose the role into the current class. Now this class will have the radius attribute that was defined in the <em>Radius</em> role.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The <em>Circle</em> defines a <em>color</em> attribute. The <em>color</em> is a read/write (<em>rw</em>), a string (<em>Str</em>) with a default value of <em>&#39;blue&#39;</em>.</p>
<p class="sb-indenthangingN"><a id="page_499"/><strong>7.</strong> The <em>calculate_area</em> method uses the <em>radius</em> attribute (consumed from the role) and the <em>pi</em> function from <em>Math::Trig</em> to calculate the area of a circle.</p>
<p class="sb-indenthangingN"><strong>8.</strong> Moose provides a <em>new</em> constructor that creates a blessed object. The user calls <em>new</em> with the value for the radius as its argument. This was required by the role when defining the <em>&#39;radius&#39;</em> attribute on line 3: <em>required=&gt;1</em>;.</p>
<p class="sb-indenthangingN"><strong>9.</strong> The the <em>new</em> object and its attibutes are displayed by <em>Dumper</em>.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The radius value is reset to 3. Moose automatically created a setter called <em>&#39;radius&#39;</em> when the role was defined.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> Moose provided a getter method called <em>&#39;radius&#39;</em>. This time we use it to get the value of the radius.</p>
<p class="sb-indenthangingN1"><strong>12.</strong> The <em>calculate_area</em> method is called and returns the area of the circle, <em>$c1;.</em></p>
<p class="sb-indenthangingN1"><strong>13.</strong> <em>Dumper</em> displays the <em>Shape::Circle</em> object.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec17">14.4.5 Overriding a Parent Method and the <em>SUPER</em> Pseudo Class</h4>
<p class="noindent">There are times when two classes may have a method with the same name. If a derived class has a method with the same name as the base class, its method will take precedence over the base method. To override the method in the derived class so you can access the method in the base class, the name of the method must be fully qualified with the class name and two colons. The pseudo class called <em>SUPER</em> can also be used by a subclass to call a method in the parent class; for example, <em>$self</em>-<em>&gt;SUPER::setName</em> would call the method <em>setName</em> in the parent class of the current module, and override the <em>setName</em> method in the current class. This allows the subclass to wrap or specialize an existing method with its parent method or completely override its own method with the parent&#8217;s method. (You can also download the <em>SUPER</em> module from cpan to control dispatching methods to a superclass.)<sup><a id="ch14fn8a" href="ch14.html#ch14fn8">8</a></sup></p>
</div>
<p class="footnote"><a id="ch14fn8" href="ch14.html#ch14fn8a">8</a>. <em>SUPER</em> isn&#8217;t a method. It&#8217;s a virtual package, documented in <em>perlobj</em> under the &#8220;Method Invocation&#8221; section. It bases itself on the current package, not the package of the object you call it with.</p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa25"/>EXAMPLE 14.25</p>
<p class="codelink1"><a id="p14exa25" href="ch14_images.html#p14exa25a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;<span class="EmpStrong">package Employee;</span>&#160;&#160;# <span class="EmpItalic">Base class</span><br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>&#160;&#160;&#160;sub new {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Employee's constructor is defined</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my %params = @_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = { Name=&gt;$params{"Name"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Salary=&gt;$params{"Salary"},<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;};<br/>&#160;&#160;&#160;&#160;&#160;&#160;bless ($self, $class);<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/><a id="page_500"/>2&#160;&#160;<span class="EmpStrong">sub display</span> {&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Instance method</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;foreach my $key ( @_){<br/>3&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print "$key: $self-&gt;{$key}\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>4&#160;&#160;&#160;&#160;&#160;print "The class using this display method is ", ref($self),"\n";<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;---------------------------------------------------------------------<br/>5&#160;&#160;<span class="EmpStrong">package Salesman;</span>&#160;&#160;# <span class="EmpItalic">Derived class</span><br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>6&#160;&#160;use base qw(<span class="EmpStrong">Employee);</span><br/>7&#160;&#160;<span class="EmpStrong">sub new</span> {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Constructor in derived Salesman class</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;my $class = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my (%params) = @_;<br/>8&#160;&#160;&#160;&#160;&#160;<span class="EmpStrong">my $self = $class-&gt;SUPER::new(%params);</span>&#160;&#160;# <span class="EmpItalic">Call constructor</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">in base class</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{Commission} = $params{Commission};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;sub set_salary {<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$self-&gt;{Salary}=$self-&gt;{Salary} + $self-&gt;{Commission};<br/>&#160;&#160;&#160;}<br/>9&#160;&#160;<span class="EmpStrong">sub display</span>{<br/>&#160;&#160;&#160;&#160;&#160;&#160;my $self = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my @args = @_;<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "Stats for the Salesman\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "-" x 25, "\n";<br/>10&#160;&#160;&#160;&#160;<span class="EmpStrong">$self-&gt;SUPER::display(@args);</span>&#160;&#160;# <span class="EmpItalic">SUPER references the parent class</span><br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;1;<br/>&#160;&#160;&#160;&#160;-----------------------------------------<br/>&#160;&#160;&#160;# <span class="EmpItalic">User or Driver Program</span><br/>11 use Salesman;<br/>&#160;&#160;&#160;use strict;<br/>&#160;&#160;&#160;use warnings;<br/>12 my $emp = new Salesman ( "Name", "Tom Savage",<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Salary", 50000,&#160;&#160;&#160;# <span class="EmpItalic">Call to constructor</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"Commission", 1500,<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;);<br/>&#160;&#160;&#160;$emp-&gt;set_Salary;&#160;&#160;# <span class="EmpItalic">Call to the access method</span><br/>13 <span class="EmpStrong">$emp-&gt;display( "Name" , "Salary", "Commission");</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Call Salesman's display method</span><br/><br/>(Output)<br/>9&#160;&#160;<span class="EmpItalic">Stats for the Salesman</span><br/>&#160;&#160;&#160;<span class="EmpItalic">-------------------------</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Name: Tom Savage</span><br/>&#160;&#160;&#160;<span class="EmpItalic">Salary: 51500</span><br/>&#160;&#160;&#160;<span class="EmpItalic">The class using this display method is Salesman</span></p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_501"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The class <em>Employee</em> is declared. It contains a constructor method called <em>new</em> and an instance method called <em>display.</em></p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>display</em> access method is defined for the <em>Employee</em> class.</p>
<p class="sb-indenthangingN"><strong>3.</strong> The attributes for the employee are displayed.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>ref</em> function returns the name of the class of a blessed object.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The <em>Salesman</em> class is declared.</p>
<p class="sb-indenthangingN"><strong>6.</strong> It will inherit from the <em>Employee</em> base class. It is a derived class.</p>
<p class="sb-indenthangingN"><strong>7.</strong> This is the <em>Saleman</em>&#8217;s constructor.</p>
<p class="sb-indenthangingN"><strong>8.</strong> The <em>SUPER</em> pseudo class is used to call <em>new</em> in the <em>Employee</em> class. It sends <em>Salesman</em> to the <em>Employee</em> class where it will be assigned initial properties and blessed and returned as a new <em>Salesman</em>.</p>
<p class="sb-indenthangingN"><strong>9.</strong> This is the <em>display</em> method for the <em>Salesman</em> class.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> By qualifying the name of the method to be of class <em>SUPER</em>, this <em>display</em> method will invoke the <em>display</em> method in the parent class, <em>Employee</em>.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> This is the driver program. It uses the <em>Salesman</em> module.</p>
<p class="sb-indenthangingN1"><strong>12.</strong> A new <em>Salesman</em> object is created, using the pseudo <em>SUPER</em> class.</p>
<p class="sb-indenthangingN1"><strong>13.</strong> The <em>display</em> method is called. Since there is a <em>display</em> subroutine in the <em>Salesman</em> class, it is the one that will be called.</p>
<hr/></div>
<div class="heading">
<h3 id="ch14lev1sec5">14.5 Plain Old Documentation&#8212;Documenting a Module</h3>
<p class="noindent">One of the most important phases in creating a useful class is providing the user with good documentation describing how a module should be used. This is called the <strong>public user interface</strong>. Whether a module is an object-oriented class or a procedural module, there must be some published user interface&#8212;the written documentation&#8212;available describing how the programmer (client) should use a class (for example, what arguments will be passed to a method). The publicly defined interface should not change, even if something in the class is changed.</p>
</div>
<p class="indent">Perl 5 introduced <em>pod</em> commands as a way to document modules. This is done by interspersing the program with <em>pod</em> (Plain Old Documentation) instructions, similar to embedding HTML or <em>nroff</em> instructions within the text of a file. Then the program is run through a Perl filtering program, which translates the commands into manual pages in a number of different formats. Wikipedia has excellent documentation on how to use <em>pod.</em><sup><a id="ch14fn9a" href="ch14.html#ch14fn9">9</a></sup></p>
<p class="footnote"><a id="ch14fn9" href="ch14.html#ch14fn9a">9</a>. See <em><a href="http://en.wikipedia.org/wiki/Plain_Old_Documentation#Example">http://en.wikipedia.org/wiki/Plain_Old_Documentation#Example</a>.</em></p>
<div class="fig-heading">
<div class="image"><a id="page_502"/><a id="ch14fig06"/><img src="graphics/14fig06.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.6</strong> The example <em>pod</em> at Wikipedia.org.</p>
</div>
<div class="heading">
<h4 id="ch14lev2sec18">14.5.1 <em>pod</em> Files</h4>
<p class="noindent">If you look in the standard Perl library, you will find that the modules contain documentation explaining what the module is supposed to do and how to use it. (At the command line, type <em>perldoc perlpod</em>.) The documentation is either embedded within the program or placed at the end of the program right after the special literal <em>_ _END_ _</em>. This documentation is called <em>pod</em>, short for Plain Old Documentation. A <em>pod</em> file is just an ASCII, utf-8, Unicode text file embedded with special commands that can be translated by one of Perl&#8217;s special interpreters, <em>pod2html</em>, <em>pod2latex</em>, <em>pod2text,</em> or <em>pod2man</em>. The purpose is to create formatted <a id="page_503"/>documents that can be represented in a number of ways. The UNIX <em>man</em> pages are an example of documentation that has been formatted with <em>nroff</em> instructions. It is now easy to embed a set of <em>pod</em> formatting instructions in your scripts to provide documentation in any of the four formats: text, HTML, LaTeX, or <em>nroff</em>.</p>
</div>
<p class="indent">The first line of the <em>pod</em> documentation starts with an equal sign (<em>=</em>). Each <em>pod</em> instruction starting with an equal sign is a formatting instruction for the <em>pod</em> translator. <strong>Each formatting instruction must be terminated with a blank line.</strong></p>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa26"/>EXAMPLE 14.26</p>
<p class="codelink1"><a id="p14exa26" href="ch14_images.html#p14exa26a">Click here to view code image</a></p>
<p class="pre1">(The standard Perl library, under the subdirectory Math.)<br/><br/>=<span class="EmpStrong">head1</span> NAME<br/><br/>Math::BigFloat - Arbitrary length float math package<br/><br/>=<span class="EmpStrong">head1</span> SYNOPSIS<br/><br/>&#160;&#160;use Math::BigFloat;<br/>&#160;&#160;$f = Math::BigFloat-&gt;new($string);<br/><br/>&#160;&#160;$f-&gt;fadd(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;addition<br/>&#160;&#160;$f-&gt;fsub(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;subtraction<br/>&#160;&#160;$f-&gt;fmul(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;multiplication<br/>&#160;&#160;$f-&gt;fdiv(NSTR[,SCALE]) returns NSTR&#160;&#160;&#160;&#160;&#160;division to SCALE places<br/>&#160;&#160;$f-&gt;fneg() return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;negation<br/>&#160;&#160;$f-&gt;fabs() return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;absolute value<br/>&#160;&#160;$f-&gt;fcmp(NSTR) return CODE&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compare undef,&lt;0,=0,&gt;0<br/>&#160;&#160;$f-&gt;fround(SCALE) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;round to SCALE digits<br/>&#160;&#160;$f-&gt;ffround(SCALE) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;round at SCALEth place<br/>&#160;&#160;$f-&gt;fnorm() return (NSTR)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;normalize<br/>&#160;&#160;$f-&gt;fsqrt([SCALE]) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sqrt to SCALE places<br/><br/>(Here is the documentation found at the end of the <span class="EmpItalic">BigFloat.pm</span> module in <span class="EmpStrong">=head1</span> DESCRIPTION<br/><br/>All basic math operations are overloaded if you declare your big<br/>floats as<br/><br/>&#160;&#160;&#160;$float = new Math::BigFloat "2.123123123123123123123123123123123";<br/><br/>=over 2<br/><br/><span class="EmpStrong">=item</span> number format<br/><br/>canonical strings have the form /[+-]\d+E[+-]\d+/ . Input values can<br/>have inbedded whitespace.<br/><br/><a id="page_504"/><span class="EmpStrong">=item</span> Error returns 'NaN'<br/><br/>An input parameter was "Not a Number" or divide by zero or sqrt of<br/>negative number.<br/><br/><span class="EmpStrong">=item</span> Division is computed to<br/><br/>C&lt;max($div_scale,length(dividend)+length(divisor))&gt; digits by default.<br/>Also used for default sqrt scale.<br/><br/>=back<br/><br/><span class="EmpStrong">=head1</span> BUGS<br/><br/>The current version of this module is a preliminary version of the<br/>real thing that is currently (as of perl5.002) under development.<br/><br/><span class="EmpStrong">=head1</span> AUTHOR<br/><br/>Mark Biggar<br/><br/>=cut</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sidebarpara">The preceding text is a <em>pod</em> file. It consists of lines starting with an equal sign and a <em>pod</em> command, then a blank line, and text. Perl provides a special translator program that reads the <em>pod</em> file and translates it into a readable file in plain text, HTML format, <em>nroff</em> text, or LaTeX. The next section describes how to use the <em>pod</em> filter programs to make the translation for you.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec19">14.5.2 <em>pod</em> Commands</h4>
<p class="noindent">It&#8217;s easy to embed <em>pod</em> instructions in a text file. Commands are placed at the beginning of a line, starting with <em>=pod</em> (or any other <em>pod</em> command) and ending with <em>=cut</em>. Everything after the first <em>=pod</em> instruction to the <em>=cut</em> instruction will be ignored by the compiler, just as comments are ignored. The nice thing about using the commands is that they allow you to create bold, italic, or plain text, to indent, to create headings, and more. <a href="ch14.html#ch14tab03">Table 14.3</a> contains a list of instructions.</p>
</div>
<div class="tab-heading">
<div class="image"><a id="ch14tab03"/><img src="graphics/14tab03.jpg" alt="Image"/></div>
<p class="tab-caption"><strong>Table 14.3</strong> <em>pod</em> Commands</p>
</div>
<div class="heading">
<h5 id="ch14lev3sec14">Checking Your pod Commands</h5>
<p class="noindent">To check that you have correct <em>pod</em> instructions in your file, you can use Perl&#8217;s <em>podchecker</em> command. First, to find the path to your modue, type at your prompt:</p>
</div>
<p class="pre"><span class="EmpStrong">perldoc -l</span> Module.pm</p>
<p class="noindent"><a id="page_505"/>and then,</p>
<p class="pre"><span class="EmpStrong">podchecker</span> path/Module.pm</p>
<p class="noindent">and hope that it displays the following:</p>
<p class="pre">path/Module.pm <span class="EmpStrong">pod syntax OK.</span></p>
<div class="heading">
<h4 id="ch14lev2sec20"><a id="page_506"/>14.5.3 How to Use the <em>pod</em> Interpreters</h4>
<p class="noindent">The <em>pod</em> interpreters come with the Perl distribution and are located in the <em>bin</em> directory under the main Perl directory; for example, in <em>/usr/bin/perl5/bin.</em></p>
</div>
<p class="indent">The four interpreters are</p>
<p class="indenthangingB">&#8226; <em>pod2html</em> (translate to HTML)</p>
<p class="indenthangingB">&#8226; <em>pod2text</em> (translate to plain text)</p>
<p class="indenthangingB">&#8226; <em>pod2man</em> (translate to <em>nroff</em>, like UNIX <em>man</em> pages)</p>
<p class="indenthangingB">&#8226; <em>pod2latex</em> (translate to LaTeX)</p>
<p class="indent">The easiest way to use the interpreters is to copy the one you want into your own directory. For example:</p>
<p class="codelink"><a id="p506pro01" href="ch14_images.html#p506pro01a">Click here to view code image</a></p>
<p class="pre">$ cp /usr/bin/perl5/bin/pod2text</p>
<p class="noindent">You may also copy the library routine into your directory:</p>
<p class="codelink"><a id="p506pro02" href="ch14_images.html#p506pro02a">Click here to view code image</a></p>
<p class="pre">$ cp /usr/bin/perl5/lib/BigFloat.pm</p>
<p class="indent">Now when you list the contents of the directory, you should have both the <em>pod</em> interpreter and the library module.</p>
<p class="pre">$ ls<br/>BigFloat.pm<br/>pod2text</p>
<div class="heading">
<h4 id="ch14lev2sec21">14.5.4 Translating <em>pod</em> Documentation into Text</h4>
<p class="noindent">The easiest way to translate the <em>pod</em> commands to text for your terminal screen is to use the <em>perldoc</em> command that comes with the Perl distribution. It may not be in your search path, but it is usually found in the <em>bin</em> directory under <em>perl</em>. The following command would display all the documentation for the <em>BigFloat.pm</em> module:</p>
</div>
<p class="pre">perldoc Math::BigFloat</p>
<p class="indent">Another way to translate <em>pod</em> directives to text is to let the <em>pod</em> interpreter filter through the module and create an output file to save the translated text. If you don&#8217;t redirect the output to a file, it will simply go to the screen.</p>
<p class="codelink"><a id="p506pro03" href="ch14_images.html#p506pro03a">Click here to view code image</a></p>
<p class="pre">$ pod2text BigFloat.pm &gt; BigFloat.Text<br/>$ cat BigFloat.Text&#160;&#160;(The output file after pod commands have been<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;translated into text.)<br/><br/>NAME<br/>&#160;&#160;&#160;&#160;Math::BigFloat - Arbitrary length float math package<br/><br/>SYNOPSIS<br/>&#160;&#160;&#160;&#160;&#160;&#160;use Math::BigFloat;<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f = Math::BigFloat-&gt;new($string);<br/><br/><a id="page_507"/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fadd(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;addition<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fsub(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;subtraction<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fmul(NSTR) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;multiplication<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fdiv(NSTR[,SCALE])&#160;&#160;&#160;returns NSTR&#160;&#160;&#160;division to SCALE places<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fneg() return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;negation<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fabs() return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;absolute value<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fcmp(NSTR) return CODE&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compare undef,&lt;0,=0,&gt;0<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fround(SCALE) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;round to SCALE digits<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;ffround(SCALE) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;round at SCALEth place<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fnorm() return (NSTR)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;normalize<br/>&#160;&#160;&#160;&#160;&#160;&#160;$f-&gt;fsqrt([SCALE]) return NSTR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sqrt to SCALE places<br/><br/>DESCRIPTION<br/>&#160;&#160;&#160;&#160;All basic math operations are overloaded if you declare your big<br/>&#160;&#160;&#160;&#160;floats as<br/><br/>$float=newMath::BigFloat"2.123123123123123123123123123123123";<br/><br/>&#160;&#160;&#160;&#160;&#160;number format<br/>&#160;&#160;&#160;&#160;&#160;canonical strings have the form /[+-]\d+E[+-]\d+/ . Input<br/>&#160;&#160;&#160;&#160;&#160;values can have inbedded whitespace.<br/><br/>&#160;Error returns 'NaN'<br/>&#160;&#160;&#160;&#160;&#160;&#160;An input parameter was "Not a Number" or divide by zero or<br/>&#160;&#160;&#160;&#160;&#160;&#160;sqrt of negative number.<br/><br/>&#160;Division is computed to<br/>&#160;&#160;&#160;&#160;&#160;&#160;`max($div_scale,length(dividend)+length(divisor))' digits by<br/>&#160;&#160;&#160;&#160;&#160;&#160;default. Also used for default sqrt scale.<br/><br/>BUGS<br/>&#160;&#160;&#160;&#160;The current version of this module is a preliminary version of<br/>&#160;&#160;&#160;&#160;the real thing that is currently (as of perl5.002) under<br/>&#160;&#160;&#160;&#160;development.<br/><br/>AUTHOR<br/>&#160;&#160;&#160;&#160;Mark Biggar</p>
<div class="heading">
<h4 id="ch14lev2sec22">14.5.5 Translating <em>pod</em> Documentation into HTML</h4>
<p class="noindent">To create an HTML document, use the <em>pod2html</em> command:</p>
</div>
<p class="codelink"><a id="p507pro01" href="ch14_images.html#p507pro01a">Click here to view code image</a></p>
<p class="pre">$ pod2html BigFloat.pm BigFloat.pm.html</p>
<p class="indent">The <em>pod2html</em> translator will create a file called <em>BigFloat.pm.html.</em> Now open your browser window click on File &gt; Open or &lt;CTRL&gt;+O and get <em>BigFloat.pm.html</em> as file protocol in the URL location box; for example, &lt;<em>file:///yourdirectory path/BigFloat.pm.html</em>&gt;.<sup><a id="ch14fn10a" href="ch14.html#ch14fn10">10</a></sup></p>
<p class="footnote"><a id="ch14fn10" href="ch14.html#ch14fn10a">10</a>. If you receive some obscure diagnostic messages, it may be that the documentation for the <em>.pm</em> file contains links to some other page that cannot be resolved by the <em>pod</em> filter.</p>
<div class="fig-heading">
<div class="image"><a id="page_508"/><a id="ch14fig07"/><img src="graphics/14fig07.jpg" alt="Image"/></div>
<p class="fig-caption"><strong>Figure 14.7</strong> Plain Old Documentation Viewed in a Browser.</p>
</div>
<div class="heading">
<h3 id="ch14lev1sec6">14.6 Using Objects from the Perl Library</h3>
<p class="noindent">In <a href="ch13.html#ch13">Chapter 13</a>, &#8220;<a href="ch13.html#ch13">Modularize It, Package It, and Send It to the Library!</a>&#8221; we first looked into the standard Perl library that was provided with this distribution, Perl 5.16. In that library were a number of Perl modules and subdirectories or folders containing additional modules and subdirectories. The examples covered in <a href="ch13.html#ch13">Chapter 13</a> dealt with modules that did not require knowledge about Perl&#8217;s use of objects. Those files utilized standard subroutines, not methods. Now that you know how objects and methods are used in Perl, the following examples will demonstrate how to use those modules that require the OOP methodology.</p>
</div>
<div class="heading">
<h4 id="ch14lev2sec23"><a id="page_509"/>14.6.1 An Object-Oriented Module from the Standard Perl Library</h4>
<p class="noindent">The following module, <em>BigFloat</em>, is an object-oriented module that allows the use of floating-point numbers of arbitrary length. Number strings have the form <em>/[+-]\d*\.?\d*E[+-]\d+/</em>. When NaN is returned, it means that a non-number was entered as input, that perhaps you tried to divide by zero, or that you tried to take the square root of a negative number. <em>BigFloat</em> uses the <em>overload</em> module, which allows you to define Perl&#8217;s built-in operators to methods that will cause the operators to behave in a new way. The operator is the key and the method assigned is the value as you can see in the following example. (See <em>overload.pm</em> in the standard Perl library.)</p>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa27"/>EXAMPLE 14.27</p>
<p class="codelink1"><a id="p14exa27" href="ch14_images.html#p14exa27a">Click here to view code image</a></p>
<p class="pre1">(The File: <span class="EmpItalic">BigFloat.pm</span>)<br/><br/>1&#160;&#160;package Math::BigFloat;<br/>2&#160;&#160;use Math::BigInt;<br/><br/>&#160;&#160;&#160;use Exporter;&#160;&#160;# <span class="EmpItalic">Just for use to be happy</span><br/>&#160;&#160;&#160;@ISA = (Exporter);<br/>3&#160;&#160;<span class="EmpStrong">use overload</span><br/>4&#160;&#160;'+'&#160;&#160;&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat &#38;fadd},<br/>&#160;&#160;&#160;'-'&#160;&#160;&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$_[2]? fsub($_[1],${$_[0]}) : fsub(${$_[0]},$_[1])},<br/>&#160;&#160;&#160;'&lt;=&gt;'&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$_[2]? fcmp($_[1],${$_[0]}) : fcmp(${$_[0]},$_[1])},<br/>&#160;&#160;&#160;'cmp'&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$_[2]? ($_[1] cmp ${$_[0]}) : (${$_[0]} cmp $_[1])},<br/>&#160;&#160;&#160;'*'&#160;&#160;&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat &#38;fmul},<br/>&#160;&#160;&#160;'/'&#160;&#160;&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$_[2]? scalar fdiv($_[1],${$_[0]}) :<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;scalar fdiv(${$_[0]},$_[1])},<br/>&#160;&#160;&#160;'neg'&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat &#38;fneg},<br/>&#160;&#160;&#160;'abs'&#160;&#160;=&gt;&#160;&#160;sub {new Math::BigFloat &#38;fabs},<br/>&#160;&#160;&#160;qw(<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;""&#160;&#160;&#160;stringify<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0+&#160;&#160;&#160;numify)&#160;&#160;&#160;&#160;# <span class="EmpItalic">Order of arguments unsignificant</span><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;;<br/><br/>5&#160;&#160;<span class="EmpStrong">sub new</span> {<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($class) = shift;<br/>&#160;&#160;&#160;&#160;&#160;&#160;my ($foo) = fnorm(shift);<br/>6&#160;&#160;&#160;&#160;&#160;panic("Not a number initialized to Math::BigFloat")<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if $foo eq "NaN";<br/>7&#160;&#160;&#160;&#160;&#160;bless \$foo, $class;<br/>&#160;&#160;&#160;}<br/><br/>&#160;&#160;&#160;&#160;&#160;<span class="EmpItalic">&lt; Methods continue here. Module was too long to put here&gt;</span><br/><a id="page_510"/>&#160;&#160;&#160;# <span class="EmpItalic">Addition</span><br/>8&#160;&#160;<span class="EmpStrong">sub fadd</span> { #(fnum_str, fnum_str) return fnum_str<br/>&#160;&#160;&#160;&#160;&#160;&#160;local($x,$y) = (fnorm($_[$[]),fnorm($_[$[+1]));<br/>&#160;&#160;&#160;&#160;&#160;&#160;if ($x eq 'NaN' || $y eq 'NaN') {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NaN';<br/>&#160;&#160;&#160;&#160;&#160;&#160;} else {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local($xm,$xe) = split('E',$x);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local($ym,$ye) = split('E',$y);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;($xm,$x e,$ym,$ye) = ($ym,$ye,$xm,$xe) if ($xe &lt; $ye);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;norm(Math::BigInt::badd($ym,$xm.('0' x ($xe-$ye))),$ye);<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}<br/><br/>&#160;&#160;&#160;<span class="EmpItalic">&lt; Methods continue here&gt;</span><br/><br/>&#160;&#160;&#160;# <span class="EmpItalic">divisionbb</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">args are dividend, divisor, scale (optional)</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">result has at most max(scale, length(dividend),</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">length(divisor)) digits</span><br/>9&#160;&#160;<span class="EmpStrong">sub fdiv</span>&#160;&#160;&#160;&#160;#<span class="EmpItalic">(fnum_str, fnum_str[,scale]) return fnum_str</span><br/>&#160;&#160;&#160;{<br/>&#160;&#160;&#160;&#160;&#160;&#160;local($x,$y,$scale) = (fnorm($_[$[]),<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fnorm($_[$[+1]),$_[$[+2]);<br/>&#160;&#160;&#160;&#160;&#160;&#160;if ($x eq 'NaN' || $y eq 'NaN' || $y eq '+0E+0') {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'NaN';<br/>&#160;&#160;&#160;&#160;&#160;&#160;} else {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local($xm,$xe) = split('E',$x);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local($ym,$ye) = split('E',$y);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$scale = $div_scale if (!$scale);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$scale = length($xm)-1 if (length($xm)-1 &gt; $scale);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$scale = length($ym)-1 if (length($ym)-1 &gt; $scale);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$scale = $scale + length($ym) - length($xm);<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;norm(&#38;round(Math::BigInt::bdiv($xm.('0' x $scale),$ym),<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$ym),$xe-$ye-$scale);<br/>&#160;&#160;&#160;&#160;&#160;&#160;}<br/>&#160;&#160;&#160;}</p>
<hr/></div>
<div class="sidebar"><hr/>
<p class="title">Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> The <em>BigFloat</em> class is declared. The file, <em>BigFloat.pm</em> resides in the <em>Math</em> subdirectory of the standard Perl library.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>BigFloat</em> class also needs to use the <em>BigInt</em> module.</p>
<p class="sb-indenthangingN"><strong>3.</strong> With the <em>overload</em> pragma you can change the meaning of the built-in Perl operators. For example, when in <em>BigFloat,</em> the <em>+</em> operator is a key and its value an anonymous subroutine that creates an object and calls the <em>fadd</em> subroutine.</p>
<p class="sb-indenthangingN"><strong>4.</strong> The <em>+</em> operator is overloaded. See previous explanation.</p>
<p class="sb-indenthangingN"><strong>5.</strong> This is <em>BigFloat</em>&#8217;s constructor method for creating an object.</p>
<p class="sb-indenthangingN"><a id="page_511"/><strong>6.</strong> If the value is not a number, this panic message is printed.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The object is blessed into the class.</p>
<p class="sb-indenthangingN"><strong>8.</strong> This is the subroutine that performs addition on the object.</p>
<p class="sb-indenthangingN"><strong>9.</strong> This is the subroutine that performs division on the object.</p>
<hr/></div>
<div class="heading">
<h4 id="ch14lev2sec24">14.6.2 Using a Module with Objects from the Standard Perl Library</h4>
<div class="sidebar"><hr/>
<p class="title"><a id="ch14exa28"/>EXAMPLE 14.28</p>
<p class="codelink1"><a id="p14exa28" href="ch14_images.html#p14exa28a">Click here to view code image</a></p>
<p class="pre1">1&#160;&#160;use warnings;<br/>2&#160;&#160;<span class="EmpStrong">use Math::BigFloat;</span>&#160;&#160;# <span class="EmpItalic">BigFloat.pm is in the Math directory</span><br/><br/>3&#160;&#160;my $number = "000.95671234e-21";<br/>4&#160;&#160;my <span class="EmpStrong">$mathref = Math::BigFloat-&gt;new("$number");</span>&#160;&#160;# <span class="EmpItalic">Create the object</span><br/><br/>5&#160;&#160;print "\$mathref is in class ", <span class="EmpStrong">ref($mathref)</span>, "\n";<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# <span class="EmpItalic">Where is the object</span><br/><br/>6&#160;&#160;print <span class="EmpStrong">$mathref-&gt;fnorm()</span>, "\n";&#160;&#160;# <span class="EmpItalic">Use methods from the class</span><br/><br/>7&#160;&#160;print "The sum of $mathref + 500 is: ", <span class="EmpStrong">$mathref-&gt;fadd("500"),</span> "\n";<br/>8&#160;&#160;print "Division using <span class="EmpStrong">overloaded operator: ", $mathref / 200.5,</span> "\n";<br/>9&#160;&#160;print "Division using fdiv method:", <span class="EmpStrong">$mathref-&gt;fdiv("200.5"),</span> "\n";<br/><br/>10 print "Enter a number ";<br/>&#160;&#160;&#160;chomp($numstr = &lt;STDIN&gt;);<br/><br/>11 if ( <span class="EmpStrong">$mathref-&gt;fadd($numstr) eq "NaN"</span> ){<br/>&#160;&#160;&#160;&#160;&#160;&#160;print "You didn't enter a number.\n"};<br/>&#160;&#160;&#160;}<br/>&#160;&#160;&#160;# <span class="EmpItalic">Return value of NaN means the string is not a number,</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">or you divided by zero, or you took the square root</span><br/>&#160;&#160;&#160;# <span class="EmpItalic">of a negative number.</span><br/><br/>(Output)<br/>5&#160;&#160;<span class="EmpItalic">$mathref is in class Math::BigFloat</span><br/>6&#160;&#160;<span class="EmpItalic">+95671234E-29</span><br/>7&#160;&#160;<span class="EmpItalic">The sum of .00000000000000000000095671234 + 500 is:</span><br/>&#160;&#160;&#160;<span class="EmpItalic">+50000000000000000000000095671234E-29</span><br/>8&#160;&#160;<span class="EmpItalic">Division using overloaded operator:</span><br/>&#160;&#160;&#160;<span class="EmpItalic">.000000000000000000000004771632618453865336658354114713216957606</span><br/>9&#160;&#160;<span class="EmpItalic">Division using fdiv method:</span><br/>&#160;&#160;&#160;<span class="EmpItalic">+4771632618453865336658354114713216957606E-63</span><br/>10 <span class="EmpItalic">Enter a number hello</span><br/>11 <span class="EmpItalic">You didn't enter a number.</span></p>
<hr/></div>
</div>
<div class="sidebar"><hr/>
<p class="title"><a id="page_512"/>Explanation</p>
<p class="sb-indenthangingN"><strong>1.</strong> Turn on <em>warnings</em>.</p>
<p class="sb-indenthangingN"><strong>2.</strong> The <em>use</em> function loads the module <em>BigFloat.pm</em> into the program. Since this module is in a subdirectory of the library called <em>Math</em>, that subdirectory is included by prepending its name to the module with two colons.</p>
<p class="sb-indenthangingN"><strong>3.</strong> A large number (<em>e</em> notation) is assigned to <em>$number</em>.</p>
<p class="sb-indenthangingN"><strong>4.</strong> Now the methods from the module are utilized. The <em>BigFloat</em> constructor is called. A reference to the object is returned and assigned to <em>$mathref</em>.</p>
<p class="sb-indenthangingN"><strong>5.</strong> The <em>ref</em> function returns the name of the class.</p>
<p class="sb-indenthangingN"><strong>6.</strong> The <em>fnorm</em> method returns the &#8220;normal&#8221; value of <em>$number</em> in signed scientific notation. Leading zeros are stripped off.</p>
<p class="sb-indenthangingN"><strong>7.</strong> The <em>fadd</em> method adds <em>500</em> to the number.</p>
<p class="sb-indenthangingN"><strong>8.</strong> In this example, an overloaded operator is used. The <em>/</em> operator is assigned a class method, <em>fdiv</em>, to perform the division. See code from <em>BigFloat.pm</em> shown in <a href="ch14.html#ch14exa26">Example 14.26</a>.</p>
<p class="sb-indenthangingN"><strong>9.</strong> This time the <em>fdiv</em> method is called directly without using overloading to perform the division. The output is slightly different.</p>
<p class="sb-indenthangingN1"><strong>10.</strong> The user is asked to enter a number.</p>
<p class="sb-indenthangingN1"><strong>11.</strong> If <em>NaN</em> (not a number) is returned from the <em>fadd</em> method, the message is printed. This is a way you could check that user input is a valid numeric value.</p>
<hr/></div>
<div class="heading">
<h3 id="ch14lev1sec7">14.7 What You Should Know</h3>
<p class="indenthangingN"><strong>1.</strong> What does OOP mean?</p>
</div>
<p class="indenthangingN"><strong>2.</strong> What is the difference between a package and a class?</p>
<p class="indenthangingN"><strong>3.</strong> What is a method?</p>
<p class="indenthangingN"><strong>4.</strong> What is the first parameter received by a class method?</p>
<p class="indenthangingN"><strong>5.</strong> What function creates an object?</p>
<p class="indenthangingN"><strong>6.</strong> What are properties?</p>
<p class="indenthangingN"><strong>7.</strong> What is an instance method?</p>
<p class="indenthangingN"><strong>8.</strong> Does Perl have a <em>private</em> keyword?</p>
<p class="indenthangingN"><strong>9.</strong> How do you name a class? Where do you put a class?</p>
<p class="indenthangingN1"><strong>10.</strong> What is meant by class method invocation?</p>
<p class="indenthangingN1"><strong>11.</strong> What is polymorphism?</p>
<p class="indenthangingN1"><a id="page_513"/><strong>12.</strong> What is the <em>@ISA</em> array used for?</p>
<p class="indenthangingN1"><strong>13.</strong> What is a derived class?</p>
<p class="indenthangingN1"><strong>14.</strong> What is the <em>SUPER</em> class?</p>
<p class="indenthangingN1"><strong>15.</strong> What is a closure?</p>
<p class="indenthangingN1"><strong>16.</strong> What is a role?</p>
<p class="indenthangingN1"><strong>17.</strong> What is Moose?</p>
<p class="indenthangingN1"><strong>18.</strong> How do you document a class?</p>
<p class="indenthangingN1"><strong>19.</strong> What is a <em>pod</em> filter?</p>
<p class="indenthangingN1"><strong>20.</strong> How is a <em>pod</em> directive used?</p>
<div class="heading">
<h3 id="ch14lev1sec8">14.8 What&#8217;s Next?</h3>
<p class="noindent"><a href="ch15.html#ch15">Chapter 15</a>, &#8220;<a href="ch15.html#ch15">Perl Connects with MySQL</a>,&#8221; focuses on using Perl with the MySQL relational database management system, a very popular open-source, fully functional, relational database. You will learn how to issue commands at the MySQL client and then use the DBI module to issue the same commands from a Perl script.</p>
</div>
<div class="heading">
<h3 id="ch14lev1sec9">Exercise 14: What&#8217;s the Object of This Lesson?</h3>
<p class="indent"><strong>Part 1&#8212;Intro to Objects</strong></p>
</div>
<p class="indenthangingN"><strong>1.</strong> Write a module called <em>Rightnow.pm</em> that contains three methods:</p>
<p class="indenthangingNA"><strong>a.</strong> A constructor called <em>new</em>.</p>
<p class="indenthangingNA"><strong>b.</strong> A method called <em>set_time</em> to set the time. Use the <em>localtime</em> function.</p>
<p class="indenthangingNA"><strong>c.</strong> A method called <em>print_time</em> to print the time. This method will take an argument to determine whether the time is printed in military or standard time; for example, <em>print_time(&#8220;Military&#8221;);</em></p>
<p class="indenthangingNA"><strong>d.</strong> In another Perl script, use the <em>Rightnow</em> module to create a <em>Rightnow</em> object, and call the <em>print_time</em> method to produce output as follows:</p>
<p class="pre2">Time now: 2:48:20 PM<br/>Time now: 14:48:20</p>
<p class="indent"><a id="page_514"/><strong>Part 2&#8212;More Objects</strong></p>
<p class="indenthangingN"><strong>1.</strong> In a class called <em>Student</em>, create an object. The attributes for the <em>Student</em> object will be sent as arguments to the constructor method. The <em>Student</em> object will have three attributes: the <em>name</em> of the student, the student&#8217;s <em>major</em>, and a list of <em>courses</em> he is taking. Create an instance method called <em>show_student</em> that will display a <em>Student</em> object. The user of the module will create two <em>Student</em> objects and display each.</p>
<p class="indenthangingN"><strong>2.</strong> Add three new attributes to the <em>Student</em> object; for example, the student&#8217;s address, his ID number, his start date, his tuition, like so:</p>
<p class="indenthangingNP">Address: 140 Kennedy Drive,</p>
<p class="indenthangingNP">Luxembourg City, Luxembourg</p>
<p class="indenthangingNP">ID: 123A</p>
<p class="indenthangingNP">StartDate: 01/10/07</p>
<p class="indenthangingNP">Tuition: 5400.55</p>
<p class="indenthangingNP">How will you manage this? If the user has so much information to pass to the constructor, it may be a good time to create an access method called <em>set_student</em>. Finally, create three new <em>Student</em> objects.</p>
<p class="indenthangingN"><strong>3.</strong> Create two new access methods that take arguments. One is called <em>add_courses</em> and the other is called <em>drop_courses</em>. The user interface will allow the user to add or drop any number of courses by sending a list of parameters to the methods; for example:</p>
<p class="indenthangingNP"><em>$obj&gt;add_courses([&#8220;C++&#8221;, &#8220;Java&#8221;]);</em></p>
<p class="indenthangingN"><strong>4.</strong> You will use a &#8220;class&#8221; function to keep track of the number of new students. Each time you add a student, update the counter. Before exiting the program, print the number of new students. Use the <em>END</em> block.</p>
<p class="indenthangingN"><strong>5.</strong> From now on, send the data for each student to a file. It should contain a line that looks like this:</p>
<p class="codelink"><a id="p514pro01" href="ch14_images.html#p514pro01a">Click here to view code image</a></p>
<p class="pre2">John Doe:14 Main St:3456IX:Math:Trigonometry,Calculus,French:<br/>01/01/06:4500</p>
<p class="indenthangingN"><strong>6.</strong> Create another file that keeps track of the number of students. Each time you start your script, read the number from the file. When you add a new student, tell him <em>Welcome, John D</em>.</p>
<p class="indent"><a id="page_515"/><strong>Part 3&#8212;Create an Object-Oriented Module</strong></p>
<p class="indenthangingN"><strong>1.</strong> Make <em>Checking.pm</em> object oriented. The object will be &#8220;the balance&#8221; and the subroutines will be &#8220;methods.&#8221; The constructor will contain at least two attributes: the <em>balance</em> and the <em>account number</em>. The account number will be passed to the constructor as an argument. The balance will be retrieved from the register, initially set to 0. When you create the register file, append the account number to the filename. Include the account number, balance, and date in the register file. Use the <em>Checking</em> module in the ATM user script you created earlier.</p>
<p class="indenthangingN"><strong>2.</strong> Can you make more than one instance of the <em>Checking</em> object and keep track of the balance for each account?</p>
<p class="indent"><strong>Part 4&#8212;Using Inheritance</strong></p>
<p class="indenthangingN"><strong>1.</strong> Create a <em>Pet</em> class with a constructor and one access method. The constructor provides attributes for a generic pet, such as:</p>
<p class="indenthangingNP"><em>owner</em></p>
<p class="indenthangingNP"><em>name</em></p>
<p class="indenthangingNP"><em>gender</em></p>
<p class="indenthangingNA"><strong>a.</strong> The access method is called <em>eat()</em>. It takes one argument: the type of food a specific pet eats. For example, the dog eats Alpo. The dog will not have an <em>eat()</em> method and will inherit from this class.</p>
<p class="indenthangingNA"><strong>b.</strong> Create two classes that will inherit from the <em>Pet</em> class; for example, a <em>Dog</em> and a <em>Cat</em> class. They will use the <em>Pet</em>&#8217;s constructor and add new attributes of their own. They will have a <em>speak()</em> method, but not an <em>eat()</em> method.</p>
<p class="indenthangingN"><strong>2.</strong> Now we will create a base class called <em>Bank.pm</em> and two modules that use it: <em>Checking</em> and <em>Savings.</em></p>
<p class="indenthangingNA"><strong>a.</strong> The <em>Bank.pm</em> parent class may or may not have a constructor but will contain the <em>deposit()</em>, <em>withdraw()</em>, and <em>get_balance()</em> methods from the <em>Checking.pm</em> module.</p>
<p class="indenthangingNA"><strong>b.</strong> Remove <em>deposit()</em> and <em>withdraw()</em> from <em>Checking.pm</em>. The program that uses <em>Checking.pm</em> will inherit these methods from <em>Bank.pm</em> via <em>@ISA</em>.</p>
<p class="indenthangingNA"><strong>c.</strong> Create another module called <em>Savings.pm</em>.</p>
<p class="indenthangingNA"><strong>d.</strong> Both <em>Checking.pm</em> and <em>Savings.pm</em> will use the <em>Bank</em> module and inherit its methods. Each will have its own constructor and attributes. One attribute is the status of the account. It can be &#8220;active&#8221; or &#8220;closed.&#8221; The <em>Savings</em> account accrues compounded daily interest 1% and must start with a minimum balance of $200. The <em>Checking</em> account has overdraft protection and charges $35 for each bounced check. It will not allow an overdraft of over $300. It can be opened with a starting balance of $25.</p>
<p class="indenthangingNA"><strong>e.</strong> The <em>Checking.pm</em> and <em>Savings.pm</em> modules will each have its own account numbers and registers.</p>
<p class="indenthangingNA"><a id="page_516"/><strong>f.</strong> The ATM script will use both modules. The user script will have a main menu allowing the user to select either of the two accounts. After getting a new account object, the user can select from the types of transactions (submenu in your original <em>Checking.pm</em> module) for that account and continue transactions until he is ready to quit. When he exits, his account register balance will be updated and he will be asked if he wants to return to the main menu. If he says &#8220;yes,&#8221; he will see the main menu again, and if he says &#8220;no,&#8221; the program will exit, giving him his balance. You will have to uniquely name the register for each account so you can differentiate between savings and checking accounts.</p>
<p class="indenthangingNAP">Example: <em>perl user.pl</em> (where user input is in bold)</p>
<p class="indenthangingNAP">Welcome!</p>
<p class="indenthangingNAP">Select an account type:</p>
<p class="indenthangingNAPN">1) Checking</p>
<p class="indenthangingNAPN">2) Savings</p>
<p class="indenthangingNAP"><strong>1</strong></p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>1</strong></p>
<p class="indenthangingNAP">How much do you want to deposit? 5.00</p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>3</strong></p>
<p class="indenthangingNAP">Your balance is $30.00</p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>2</strong></p>
<p class="indenthangingNAP"><a id="page_517"/>How much do you want to withdraw? 5.00</p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>3</strong></p>
<p class="indenthangingNAP">Your balance is $25.00</p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>4</strong></p>
<p class="indenthangingNAP">Return to the main menu? <strong>Y</strong></p>
<p class="indenthangingNAP">Welcome!</p>
<p class="indenthangingNAP">Select an account type:</p>
<p class="indenthangingNAPN">1) Checking</p>
<p class="indenthangingNAPN">2) Savings</p>
<p class="indenthangingNAP"><strong>2</strong></p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>3</strong></p>
<p class="indenthangingNAP">Your balance is $100.00</p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>1</strong></p>
<p class="indenthangingNAP"><a id="page_518"/>How much do you want to deposit? <strong>25</strong></p>
<p class="indenthangingNAP">Select a function:</p>
<p class="indenthangingNAPN">1) deposit</p>
<p class="indenthangingNAPN">2) withdraw</p>
<p class="indenthangingNAPN">3) get balance</p>
<p class="indenthangingNAPN">4) exit</p>
<p class="indenthangingNAP"><strong>4</strong></p>
<p class="indenthangingNAP">Your balance is 125.00.</p>
<p class="indent"><strong>Part 5</strong></p>
<p class="indenthangingN"><strong>1.</strong> Go to the <em>pod</em> directory in the standard Perl library. Look for <em>perlpod.html</em>. The file contains Larry Wall&#8217;s user interface for using <em>pod</em> commands to document your Perl programs.</p>
<p class="indenthangingN"><strong>2.</strong> Go to your browser and in the Location box, type:</p>
<p class="codelink"><a id="p518pro01" href="ch14_images.html#p518pro01a">Click here to view code image</a></p>
<p class="pre2">file:/&lt;directory-to -your-library-file&gt;/Pod/pod.html</p>
<p class="indenthangingNP">Now you have the instructions for creating <em>pod</em> documentation.</p>
<p class="indenthangingN"><strong>3.</strong> Create a published interface for your <em>Checking.pm</em> module. Embed <em>pod</em> commands in your <em>Checking.pm</em> script explaining how the module should be used. Follow the guidelines of the modules in the library; for example, there should be a NAME, SYNOPSIS, DESCRIPTION, AUTHOR, and so forth. Run the <em>pod</em> file through the <em>pod2html</em> filter and display the documentation in your browser. Use the <em>perldoc</em> command to print your documentation on the terminal screen.</p>
</body>
</html>
